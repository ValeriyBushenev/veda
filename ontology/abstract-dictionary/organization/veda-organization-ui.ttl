
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix v-s: <http://semantic-machines.com/veda/veda-schema/> .
@prefix v-ui: <http://semantic-machines.com/veda/veda-ui/> .
@prefix d: <http://semantic-machines.com/veda/veda-data/> .

<http://semantic-machines.com/veda/veda-organization-ui>
  rdf:type owl:Ontology ;
  rdfs:label "Онтология системы Veda. Организация. UI."@ru ;
  rdfs:label "Veda system ontology. Organization. UI."@en ;
#  owl:versionInfo "1.3" ;
  v-s:loadPriority 6 ;
.

# ------------------------------------------------------------ МОДЕЛИ --

v-s:OrganizationUnitModel
  rdf:type v-ui:ClassModel ;
  v-ui:forClass v-s:OrganizationUnit ;
  v-ui:forClass v-s:OrgGroup ;
  v-ui:forClass v-s:Organization ;
  v-ui:forClass v-s:Subsidiary ;
  v-ui:forClass v-s:Department ;
  v-ui:forClass v-s:Position ;
  v-ui:forClass v-s:Appointment ;
  rdfs:comment "Модель для класса v-s:OrganizationUnit"@ru ;
  rdfs:comment "Model for v-s:OrganizationUnit class"@en ;
  rdfs:label "Модель организационной единицы"@ru ;
  rdfs:label "Organization unit model"@en ;
  v-s:script """
  /**
   * @method
   * @param unit {String/veda.IndividualModel} Super unit uri or individual.
   * @return {boolean}.
   */
  this.isSubUnitOf = function (unit, depth) {
    depth = depth || 0;
    var self = this;
    if (typeof unit.valueOf() === "string") {
      unit = new veda.IndividualModel( unit.valueOf() );
    }
    if (!this.hasValue("v-s:parentUnit") || depth > 16) return false;
    return this["v-s:parentUnit"].reduce(function (state, item) {
      return state || (item.id === unit.id) || self.isSubUnitOf.call(item, unit, depth + 1);
    }, false);
  };

  /**
   * @method
   * @param unit {String/veda.IndividualModel} Super unit uri or individual.
   * @return {veda.IndividualModel | false }.
   */
  this.getChief = function (chiefId, depth) {
    depth = depth || 0;
    var self = this;
    var chiefId = chiefId || this.id;
    if ( (this.hasValue("v-s:hasChief") || depth > 16) && this["v-s:hasChief"][0].id !== chiefId ) {
      return this["v-s:hasChief"][0];
    }
    return this["v-s:parentUnit"].reduce(function (state, item) {
      return state || self.getChief.call(item, chiefId, depth + 1);
    }, undefined);
  };

  this.getFieldChief = function (depth) {
    depth = depth || 0;
    var self = this;
    if ( (this.hasValue("v-s:hasFieldChief") || depth > 16) ) {
      return this["v-s:hasFieldChief"][0];
    }
    return this["v-s:parentUnit"].reduce(function (state, item) {
      return state || self.getFieldChief.call(item, depth + 1);
    }, undefined);
  };

  /**
   * @method
   * @param unit {String/veda.IndividualModel} Super unit uri or individual.
   * @return {veda.IndividualModel | false }.
   */
  this.getOrganization = function (depth) {
    depth = depth || 0;
    var self = this;
    if ( this.is("v-s:Organization") || depth > 16) {
      return this;
    }

    return this["v-s:parentUnit"].reduce(function (state, item) {
      return state || item.getOrganization(depth + 1);
    }, undefined);
  };

  //# sourceURL=v-s:OrganizationUnitModel
  """ ;
.

# ------------------------------------------------------------ СПЕЦИФИКАЦИИ --

v-s:PsHasSubsidiaryForOrganization
  rdf:type v-ui:ObjectPropertySpecification ;
  v-ui:forClass v-s:Organization ;
  v-ui:forProperty v-s:hasSubsidiary ;
  v-ui:minCardinality 0 ;
  v-ui:maxCardinality 100 ;
  v-ui:rangeRestriction v-s:Subsidiary ;
.

v-s:PsTaxIdForOrganization
  rdf:type v-ui:DatatypePropertySpecification ;
  v-ui:forClass v-s:Organization ;
  v-ui:forProperty v-s:taxId ;
  v-ui:minCardinality 1 ;
  v-ui:maxCardinality 1 ;
  v-ui:regexp "^([A-Z]{2,3}[0-9]{4,}|([0-9]{10}|[0-9]{12}))$" ;
  v-ui:tooltip "Цифро-буквенное значение, минимум 6 символов. Примеры: 123456789101, KZ4438, NL123456789B11"@ru ;
  v-ui:tooltip "Alphanumeric value, 6 characters minimum. Ex: 123456789101, KZ4438, NL123456789B11"@en ;
.

# Перенести в управление контрагентами

v-s:PsHasContractorOrganization
  rdf:type v-ui:ObjectPropertySpecification ;
  v-ui:forClass v-s:Organization;
  v-ui:forProperty v-s:hasContractor ;
  v-ui:minCardinality 0 ;
  v-ui:maxCardinality 100 ;
  v-ui:rangeRestriction v-s:Contractor;
  rdfs:label "Спецификация свойства v-s:hasContractor для класса v-s:Organization"@ru ;
  rdfs:label "v-s:hasContractor property specification for v-s:Organization"@en ;
.

v-s:PsHasClassifierCountryOrganization
  rdf:type v-ui:ObjectPropertySpecification ;
  v-ui:forClass v-s:Organization;
  v-ui:forProperty v-s:hasClassifierCountry ;
  v-ui:minCardinality 1 ;
  v-ui:maxCardinality 1 ;
  v-ui:defaultValue d:Country_RUS;
  rdfs:label "Спецификация свойства v-s:hasClassifierCountry для класса v-s:Organization"@ru ;
  rdfs:label "v-s:hasClassifierCountry property specification for v-s:Organization"@en ;
.

v-s:PslabelForOrganization
  rdf:type v-ui:PropertySpecification ;
  v-ui:forClass v-s:Organization ;
  v-ui:forProperty rdfs:label ;
  v-ui:forProperty v-s:shortLabel;
  v-ui:forProperty v-s:legalAddress;
  v-ui:forProperty v-s:postalAddress;
  v-ui:minCardinality 1 ;
  v-ui:maxCardinality 100 ;
  rdfs:label "Спецификация свойств rdfs:label, v-s:shortLabel, v-s:legalAddress, v-s:postalAddress для класса v-s:Organization"@ru ;
  rdfs:label "rdfs:label, v-s:shortLabel, v-s:legalAddress, v-s:postalAddress property specification for v-s:Organization"@en ;
.

v-s:taxRegistrationCauseForOrganization
  rdf:type v-ui:PropertySpecification ;
  v-ui:forClass v-s:Organization ;
  v-ui:forProperty v-s:taxRegistrationCause;
  v-ui:minCardinality 0 ;
  v-ui:maxCardinality 1;
  v-ui:regexp "^[0-9]{9}$";
  rdfs:label "Спецификация свойств v-s:taxRegistrationCause для класса v-s:Organization"@ru ;
  rdfs:label "v-s:taxRegistrationCause property specification for v-s:Organization"@en ;
  v-ui:tooltip "Числовое значение, 9 символов, например: 123456789"@ru ;
  v-ui:tooltip "Numeric value, 9 characters, i.e. 123456789"@en ;
.

v-s:PsContractorProfileDateToFact
  rdf:type v-ui:ObjectPropertySpecification ;
  v-ui:forClass v-s:Organization ;
  v-ui:forProperty v-s:dateToFact ;

  rdfs:label "Спецификация к свойству v-s:dateToFact для класса v-s:ContractorProfile"@ru ;
  rdfs:label "Spec for property v-s:dateToFact for class v-s:ContractorProfile"@en ;
  v-ui:placeholder "Дата ликвидации юр лица"@ru ;
  v-ui:placeholder "Registered legal persons"@en ;
.

v-s:PsContractorProfileDateFromFact
  rdf:type v-ui:ObjectPropertySpecification ;
  v-ui:forClass v-s:Organization ;
  v-ui:forProperty v-s:dateFromFact ;
  v-ui:placeholder "Дата регистрации юр лица"@ru ;
  v-ui:placeholder "Registered legal persons"@en ;
  rdfs:label "Спецификация к свойству v-s:dateFromFact для класса v-s:ContractorProfile"@ru ;
  rdfs:label "Spec for property v-s:dateFromFact for class v-s:ContractorProfile"@en ;
.

v-s:PsParentsForDepartment
  rdf:type v-ui:ObjectPropertySpecification ;
  v-ui:forClass v-s:Department ;
  v-ui:forProperty v-s:parentOrganization ;
  v-ui:forProperty v-s:parentUnit ;
  v-ui:minCardinality 1 ;
  v-ui:maxCardinality 1 ;
  rdfs:label "Спецификация к свойствам v-s:parentOrganization и v-s:parentUnit для класса v-s:Department"@ru ;
  rdfs:label "Spec for property v-s:parentOrganization and v-s:parentUnit for class v-s:Department"@en ;
.

v-s:PsTextLabelForDepartment
  rdf:type v-ui:ObjectPropertySpecification ;
  v-ui:forClass v-s:Department ;
  v-ui:forProperty rdfs:label ;
  v-ui:forProperty v-s:shortLabel ;
  v-ui:forProperty v-s:subjectCode ;
  v-ui:minCardinality 1 ;
  v-ui:maxCardinality 100 ;
  rdfs:label "Спецификация к свойствам rdfs:label и v-s:shortLabel и v-s:subjectCode для класса v-s:Department"@ru ;
  rdfs:label "Spec for property rdfs:label and v-s:shortLabel and v-s:subjectCode for class v-s:Department"@en ;
.

# ------------------------------------------------------------ СТРОКИ --

v-s:NonUniqueTaxId
  rdf:type v-s:Bundle ;
  rdfs:label "Сообщение не уникальный ИНН"@ru ;
  rdfs:label "Non unique tax id message"@en ;
  rdfs:comment "Организация с таким ИНН уже существует"@ru ;
  rdfs:comment "Organization with this tax number already exists"@en ;
.
v-s:ForSafeTaxId
  rdf:type v-s:Bundle ;
  rdfs:label "Сообщение не уникальный ИНН"@ru ;
  rdfs:label "Non unique tax id message"@en ;
  rdfs:comment "Нельзя создать огранизацию с таким ИНН"@ru ;
  rdfs:comment "Нельзя создать огранизацию с таким ИНН"@en ;
.
v-s:LegalEntityExistencePeriodBundle
  rdf:type v-s:Bundle ;
  rdfs:label "Период существования юридического лица"@ru ;
  rdfs:label "Legal entity existence period"@en ;
.
v-s:AddProfile
  rdf:type v-s:Bundle ;
  rdfs:label "Создать досье"@ru ;
  rdfs:label "Add profile"@en ;
.
v-s:AddSubsidiary
  rdf:type v-s:Bundle ;
  rdfs:label "Добавить филиал"@ru ;
  rdfs:label "Add subsidiary"@en ;
.
v-s:DepartmentCode
  rdf:type v-s:Bundle ;
  rdfs:label "Код подразделения"@ru ;
  rdfs:label "Department code"@en ;
.
v-s:PositionCode
  rdf:type v-s:Bundle ;
  rdfs:label "Код должности"@ru ;
  rdfs:label "Position code"@en ;
.
v-s:NonUniqueDepartmentCode
  rdf:type v-s:Bundle ;
  rdfs:label "Сообщение о не уникальном коде подразделения"@ru ;
  rdfs:label "Non unique department code message"@en ;
  rdfs:comment "Подразделение с таким кодом уже существует"@ru ;
  rdfs:comment "Department with this code already exists"@en ;
.
v-s:NonUniquePositionCode
  rdf:type v-s:Bundle ;
  rdfs:label "Сообщение о не уникальном коде должности"@ru ;
  rdfs:label "Non unique position code message"@en ;
  rdfs:comment "Должность с таким кодом уже существует"@ru ;
  rdfs:comment "Position with this code already exists"@en ;
.
v-s:NonUniqueTabNumber
  rdf:type v-s:Bundle ;
  rdfs:label "Сообщение о не уникальном табельном номере"@ru ;
  rdfs:label "Non unique tab number message"@en ;
  rdfs:comment "Персона с таким табельным номером уже существует"@ru ;
  rdfs:comment "Person with this tab number already exists"@en ;
.
v-s:NotValidCode
  rdf:type v-s:Bundle ;
  rdfs:label "Сообщение о не корректном коде (должности, подразделения, табельном номере)"@ru ;
  rdfs:label "Not valid subject code message"@en ;
  rdfs:comment "Поле может содержать только латинские буквы и цифры"@ru ;
  rdfs:comment "Field must consist only a-z character and digits"@en ;
.
# ------------------------------------------------------------ ШАБЛОНЫ --

v-s:OrganizationTemplate
  rdf:type v-ui:ClassTemplate ;
  v-ui:forClass v-s:Organization ;
  rdfs:label "Шаблон для класса v-s:Organization"@ru ;
  rdfs:label "Template for v-s:Organization class"@en ;
  v-ui:template """
<script>
  var _class = new veda.IndividualModel("v-s:Subsidiary");
  if ( !_class.rights.hasValue("v-s:canCreate", true) || !individual.rights.hasValue("v-s:canUpdate", true)) {
    $("#add-subsidiary", template).remove();
  }

  var prevTaxId = individual.hasValue("v-s:taxId") && individual["v-s:taxId"][0].toString();

  // Validation
  template.on("validate", function () {
    var result = {},
        regexp;
    if ( individual.hasValue("v-s:hasClassifierCountry", new veda.IndividualModel("d:Country_RUS")) && individual.hasValue("v-s:hasClassifierLegalForm", new veda.IndividualModel("d:OKOPF_50102")) ){
      regexp = /^([0-9]{12})$/gi;
    } else if ( individual.hasValue("v-s:hasClassifierCountry", new veda.IndividualModel("d:Country_RUS")) ) {
      regexp = /^([0-9]{10})$/gi;
    } else if ( individual.hasValue("v-s:hasClassifierCountry", new veda.IndividualModel("d:Country_NLD")) ){
      regexp = /^[A-Z]{1,3}[0-9]{9}[B]{1}[0-9]{2}$/gi;
    } else if ( individual.hasValue("v-s:hasClassifierCountry") ) {
      regexp = /^[A-Z]{1,3}[0-9]{4,}$/gi;
    }
    if ( !individual.hasValue("v-s:taxId") ) {
      result["v-s:taxId"] = {
        state: false,
        cause: ["v-ui:minCardinality"]
      }
    } else {

      // Check regexp
      var taxId = individual["v-s:taxId"][0].toString();
      if(taxId != '0000000000' && taxId != '000000000000'){
        result["v-s:taxId"] = {
          state: regexp.test( taxId ),
          cause: ["v-ui:regexp"]
        }
      } else {
        result["v-s:taxId"] = {
        state: false,
        cause: ["v-s:ForSafeTaxId"]
        }
      }


      // Check unique
      var newTaxId = individual.hasValue("v-s:taxId") && individual["v-s:taxId"][0].toString();
      console.log('123');
      if ( prevTaxId !== newTaxId ) { prevTaxId = newTaxId; }
      if ( result["v-s:taxId"].state ) {
        var tmp = query(veda.ticket, "'rdf:type'==='v-s:Organization' && 'v-s:taxId'=='" + taxId + "'").result;
        result["v-s:taxId"] = {
          state: (!tmp.length || tmp[0] === individual.id),
          cause: ["v-s:NonUniqueTaxId"]
        }
      }
    }
    // Если значение поля v-s:hasClassifierCountry=d:Country_RUS то поле v-s:hasClassifierLegalForm Обязательное
    if (individual.hasValue("v-s:hasClassifierCountry", new veda.IndividualModel("d:Country_RUS"))) {
      result["v-s:hasClassifierLegalForm"] = {
        state: individual.hasValue("v-s:hasClassifierLegalForm"),
        cause: ["v-ui:minCardinality"]
      }
    }
    // Если значение поля v-s:hasClassifierCountry=d:Country_RUS и поле v-s:hasClassifierLegalForm=d:OKOPF_50102 то поле v-s:taxRegistrationCause должно быть обязательным.
    if (individual.hasValue("v-s:hasClassifierCountry", "d:Country_RUS") && !individual.hasValue("v-s:hasClassifierLegalForm", "d:OKOPF_50102") && !individual.hasValue("v-s:hasClassifierLegalForm", "d:OKOPF_50000") ) {
      result["v-s:taxRegistrationCause"] = {
        state: /^[0-9]{9}$/.test(individual["v-s:taxRegistrationCause"][0]),
        cause: ["v-ui:regexp"]
      }
    }
    template.trigger("validated", result);
  });

  //# sourceURL=v-s:OrganizationTemplate_pre
</script>
<div>
  <div class="container sheet">
    <h2>
      <span about="v-s:Organization" property="rdfs:label"></span>
      <small about="@" property="rdfs:label"></small>
    </h2>
    <hr>
    <div class="row">
      <div class="col-md-4">
        <em about="v-s:shortLabel" property="rdfs:label"></em>
        <div property="v-s:shortLabel" class="view -edit -search"></div>
        <veda-control data-type="string" property="v-s:shortLabel" class="-view edit search"></veda-control>
      </div>
      <div class="col-md-8">
        <em about="rdfs:label" property="rdfs:label"></em>
        <div property="rdfs:label" class="view -edit -search"></div>
        <veda-control data-type="string" property="rdfs:label" class="-view edit search"></veda-control>
      </div>
    </div>
    <hr class="view -edit -search">
    <div class="row">
      <div class="col-md-4">
        <em about="v-s:hasClassifierCountry" property="rdfs:label"></em>
        <div rel="v-s:hasClassifierCountry" class="view -edit search" data-template="v-ui:LabelTemplate"></div>
        <veda-control data-type="link" rel="v-s:hasClassifierCountry" class="-view edit search fulltext" data-template="{individual['v-s:shortLabel'][0] + ' | ' + individual['rdfs:label'][0]}"></veda-control>
      </div>
      <div class="col-md-8">
        <em about="v-s:hasClassifierLegalForm" property="rdfs:label"></em>
        <div rel="v-s:hasClassifierLegalForm" class="view -edit search" data-template="v-ui:LabelTemplate"></div>
        <veda-control data-type="link" rel="v-s:hasClassifierLegalForm" class="-view edit search fulltext"></veda-control>
      </div>
    </div>
    <hr class="view -edit -search">
    <div class="row">
      <div class="col-sm-4">
        <em about="v-s:taxId" property="rdfs:label"></em>
        <div property="v-s:taxId" class="view -edit -search"></div>
        <veda-control data-type="string" property="v-s:taxId" class="-view edit search"></veda-control>
      </div>
      <div class="col-sm-4">
        <em about="v-s:taxRegistrationCause" property="rdfs:label"></em>
        <div property="v-s:taxRegistrationCause" class="view -edit -search"></div>
        <veda-control data-type="string" property="v-s:taxRegistrationCause" class="-view edit search"></veda-control>
      </div>
      <div class="col-sm-4">
        <em about="v-s:taxRegistrationNumber" property="rdfs:label"></em>
        <div property="v-s:taxRegistrationNumber" class="view -edit -search"></div>
        <veda-control data-type="string" property="v-s:taxRegistrationNumber" class="-view edit search"></veda-control>
      </div>
    </div>

    <hr class="view -edit -search">

    <div class="row">
      <div class="col-sm-4">
        <em about="v-s:legalAddress" property="rdfs:label"></em>
        <div property="v-s:legalAddress" class="view -edit -search"></div>
        <veda-control data-type="text" rows="3" property="v-s:legalAddress" class="-view edit search"></veda-control>
      </div>
      <div class="col-sm-4">
        <em about="v-s:postalAddress" property="rdfs:label"></em>
        <div property="v-s:postalAddress" class="view -edit -search"></div>
        <veda-control data-type="text" rows="3" property="v-s:postalAddress" class="-view edit search"></veda-control>
      </div>
    </div>
    <hr class="view -edit -search">
    <em about="v-s:LegalEntityExistencePeriodBundle" property="rdfs:label"></em>
    <div class="row">
      <div class="col-md-4">
        <div property="v-s:dateFromFact" class="view -edit -search"></div>
        <veda-control property="v-s:dateFromFact" data-type="date" class="-view edit search"></veda-control>
      </div>
      <div class="col-md-4">
        <div property="v-s:dateToFact" class="view -edit -search"></div>
        <veda-control property="v-s:dateToFact" data-type="date" class="-view edit search"></veda-control>
      </div>
    </div>
    <em about="v-s:hasSubsidiary" property="rdfs:label"></em>
    <table class="table table-condensed table-bordered">
      <thead>
        <tr class="view -edit -search active">
          <th width="1%"><span class="glyphicon glyphicon-search"></th>
          <th about="v-s:shortLabel" property="rdfs:label"></th>
          <th about="v-s:taxRegistrationCause" property="rdfs:label"></th>
          <th about="v-s:postalAddress" property="rdfs:label"></th>
        </tr>
      </thead>
      <tbody rel="v-s:hasSubsidiary" data-embedded="true">
        <tr>
          <td about="@" data-template="v-ui:IconModalTemplate"></td>
          <td>
            <div property="v-s:shortLabel" class="view -edit -search"></div>
            <veda-control property="v-s:shortLabel" data-type="string" class="-view edit search"></div>
          </td>
          <td>
            <div property="v-s:taxRegistrationCause" class="view -edit -search"></div>
            <veda-control property="v-s:taxRegistrationCause" data-type="string" class="-view edit search"></div>
          </td>
          <td>
            <div property="v-s:postalAddress" class="view -edit -search"></div>
            <veda-control property="v-s:postalAddress" data-type="string" class="-view edit search"></div>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="view -edit -search">
      <button class="btn btn-success" id="add-subsidiary">
        <span class="glyphicon glyphicon-zoom-in"></span>
        <span about="v-s:AddSubsidiary" property="rdfs:label"></span>
      </button>
    </div>

    <em about="v-s:HeadOrganization" property="rdfs:label"></em>
    <div rel="v-s:parentUnit" class="view -edit -search" data-template="v-ui:LabelTemplate"></div>
    <veda-control data-type="link" rel="v-s:parentUnit" class="-view edit search fulltext"></veda-control>
    <hr class="view -edit -search">

    <div about="@" data-template="v-ui:SystemPropertiesTemplate" data-embedded="true"></div>
    <br>
    <!-- BUTTONS -->
    <div class="actions">
      <span about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete journal"></span>
    </div>
  </div>
  <div about="@" class="container sheet view edit -search" data-template="v-s:LinksTemplate" data-embedded="true"></div>
  <div about="@" class="container sheet view -edit -search" data-template="v-s:CommentsTemplate"></div>
</div>
<script>
  //Генерация Uri
  function makeUri () {
    var shortLabel = individual["v-s:hasClassifierCountry"][0]["v-s:shortLabel"] ;
    var taxId = individual["v-s:taxId"] ;
    if ( individual.hasValue("v-s:hasClassifierCountry", "d:Country_RUS") && individual.isNew() ){
      individual.id = "d:org_"+ shortLabel + taxId ;
    } else if ( individual.isNew() ) {
      individual.id = "d:org_"+ taxId ;
    }
  }

  individual.on("beforeSave", makeUri);
  template.one("remove", function () {
    individual.off("beforeSave", makeUri);
  });

  $("#add-subsidiary", template).click(function () {
    var modal = $("#notification-modal-template").html();
    modal = $(modal);
    modal.modal({"show": false});
    $("body").append(modal);
    modal.modal("show");
    template.one("remove", function () {
      modal.modal("hide").remove();
    });
    var cntr = $(".modal-body", modal),
        _class = new veda.IndividualModel("v-s:Subsidiary"),
        subsidiary = new veda.IndividualModel(),
        tmpl = new veda.IndividualModel("v-s:SubsidiaryTemplate");
    subsidiary["rdf:type"] = [_class];
    subsidiary["v-s:backwardTarget"] = [individual];
    subsidiary["v-s:backwardProperty"] = [new veda.IndividualModel("v-s:hasSubsidiary")];
    subsidiary["v-s:canRead"] = [ true ];
    subsidiary.present(cntr, tmpl, "edit");
    subsidiary.one("beforeReset", function () {
      modal.modal("hide").remove();
    });
    subsidiary.one("afterSave", function () {
      modal.modal("hide").remove();
    });
  });
  //# sourceURL=v-s:OrganizationTemplate_post
</script>
  """ ;
.

v-s:SubsidiaryTemplate
  rdf:type v-ui:ClassTemplate ;
  v-ui:forClass v-s:Subsidiary ;
  rdfs:label "Шаблон для класса v-s:Subsidiary"@ru ;
  rdfs:label "Template for v-s:Subsidiary class"@en ;
  v-ui:template """
<div class="container sheet">
  <h2>
    <span about="v-s:Subsidiary" property="rdfs:label"></span>
    <small about="@" property="rdfs:label"></small>
  </h2>
  <span about="@" data-template="v-ui:RabbitHole"></span>
  <hr>
  <div id="mainProperties">
    <em about="v-s:parentOrganization" property="rdfs:label"></em>
    <span about="@" rel="v-s:backwardTarget" data-template="v-ui:LabelLinkTemplate"></span>


    <em about="v-s:parentUnit" property="rdfs:label"></em>
    <div rel="v-s:parentUnit" class="view -edit -search" data-template="v-ui:LabelLinkTemplate"></div>
    <veda-control data-type="link" rel="v-s:parentUnit" class="-view edit search fulltext"></veda-control>

    <hr class="view -edit -search">

    <em about="rdfs:label" property="rdfs:label"></em>
    <div property="rdfs:label" class="view -edit -search"></div>
    <veda-control data-type="string" property="rdfs:label" class="-view edit search"></veda-control>

    <em about="v-s:shortLabel" property="rdfs:label"></em>
    <div property="v-s:shortLabel" class="view -edit -search"></div>
    <veda-control data-type="string" property="v-s:shortLabel" class="-view edit search"></veda-control>

    <hr class="view -edit -search">

    <div class="row">
      <div class="col-sm-4">
        <em about="v-s:taxRegistrationCause" property="rdfs:label"></em>
        <div property="v-s:taxRegistrationCause" class="view -edit -search"></div>
        <veda-control data-type="string" property="v-s:taxRegistrationCause" class="-view edit search"></veda-control>
      </div>
    </div>

    <hr class="view -edit -search">

    <em about="v-s:postalAddress" property="rdfs:label"></em>
    <div property="v-s:postalAddress" class="view -edit -search"></div>
    <veda-control data-type="text" rows="3" property="v-s:postalAddress" class="-view edit search"></veda-control>

    <hr class="view -edit -search">

    <em about="rdfs:comment" property="rdfs:label"></em>
    <div property="rdfs:comment" class="view -edit -search"></div>
    <veda-control data-type="text" rows="3" property="rdfs:comment" class="-view edit search"></veda-control>
  </div>

  <hr>
  <div about="@" data-template="v-ui:SystemPropertiesTemplate" data-embedded="true"></div>
  <br>
  <!-- BUTTONS -->
  <div class="actions">
    <span about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete"></span>
  </div>
</div>
  """ ;
.

v-s:DepartmentTemplate
  rdf:type v-ui:ClassTemplate ;
  v-ui:forClass v-s:Department ;
  rdfs:label "Шаблон для класса v-s:Department"@ru ;
  rdfs:label "Template for v-s:Department class"@en ;
  v-ui:template """
<script>
  var parentOrganization = individual['v-s:parentOrganization'][0];
  var orgINN = parentOrganization['v-s:taxId'][0];
    if (orgINN.match('^([0-9]{10}|[0-9]{12})$')) {
      orgINN = 'RU'+orgINN;
    };
  var departmentQueryPrefix = "('rdf:type'=='v-s:Department' && 'v-s:parentOrganization'=='"+parentOrganization.id+"') || ('rdf:type'=='v-s:Organization' && '@'=='"+parentOrganization.id+"')";
  $('veda-control[rel="v-s:parentUnit"]', template).attr('data-query-prefix', departmentQueryPrefix);

  var appointmentQueryPrefix = "'rdf:type'=='v-s:Appointment' && 'v-s:parentOrganization'=='"+parentOrganization.id+"'";
  $('veda-control[rel="v-s:hasChief"]', template).attr('data-query-prefix', appointmentQueryPrefix);
  $('veda-control[rel="v-s:hasFieldChief"]', template).attr('data-query-prefix', appointmentQueryPrefix);
  $('veda-control[rel="v-s:hasFunctionalChief"]', template).attr('data-query-prefix', appointmentQueryPrefix);
  var prevSubjectCode = "";
  var state = false;
  template.on('validate', function() {
    var result = {};
    var subjectCode = individual.hasValue("v-s:subjectCode") && individual["v-s:subjectCode"][0].toString();
    // if (subjectCode) {
    //   if (prevSubjectCode != subjectCode) {
    //     prevSubjectCode = subjectCode;
    //     var futureUri = 'd:'+orgINN+'_department_'+subjectCode;
    //     var queryString = "'@'==='"+futureUri+"'";
    //     var tmp = query(veda.ticket, queryString).result;
    //     state = tmp.length == 0? true : tmp[0] == individual.id;
    //   };
    //   result["v-s:subjectCode"] = {
    //     state: state,
    //     cause: ["v-s:NonUniqueDepartmentCode"]
    //   }
    //   if (subjectCode.match('^[a-zA-z0-9]*$') == null) {
    //     result["v-s:subjectCode"] = {
    //       state: false,
    //       cause: ["v-s:NotValidCode"]
    //     } 
    //   }
    // } else {
    //   result["v-s:subjectCode"] = {
    //     state: false,
    //     cause: ["v-ui:minCardinality"]
    //   }
    // }
    if (!subjectCode) {
      result["v-s:subjectCode"] = {
        state: false,
        cause: ["v-ui:minCardinality"]
      }  
    }
    
    template.trigger("validated", result);
  });
</script>
<div class="container sheet">
  <h2>
    <span about="v-s:Department" property="rdfs:label"></span>
    <small about="@" property="rdfs:label"></small>
  </h2>
  <hr>
  <div id="mainProperties">
    <em about="v-s:parentOrganization" property="rdfs:label"></em>
    <div about="@" rel="v-s:parentOrganization" class="view edit -search">
      <a href="#/@">
        <span property="v-s:taxId"></span> - <span property="v-s:shortLabel"></span> - <span property="v-s:legalAddress"></span>
      </a>
    </div>
    <!-- <veda-control data-type="link" rel="v-s:parentOrganization" class="-view edit search fulltext"></veda-control> -->
    <em about="v-s:parentUnit" property="rdfs:label"></em>
    <div rel="v-s:parentUnit" class="view -edit -search" data-template="v-ui:LabelLinkTemplate"></div>
    <veda-control data-type="link" rel="v-s:parentUnit" class="-view edit search fulltext"></veda-control>
    <hr class="view -edit -search">
    <em about="rdfs:label" property="rdfs:label"></em>
    <div property="rdfs:label" class="view -edit -search"></div>
    <veda-control data-type="string" property="rdfs:label" class="-view edit search"></veda-control>
    <div class="row">
      <div class="col-md-6">
        <em about="v-s:shortLabel" property="rdfs:label"></em>
        <div property="v-s:shortLabel" class="view -edit -search"></div>
        <veda-control data-type="string" property="v-s:shortLabel" class="-view edit search"></veda-control>
      </div>
      <div class="col-md-6">
        <em about="v-s:DepartmentCode" property="rdfs:label"></em>
        <div property="v-s:subjectCode" class="view -edit search"></div>
        <veda-control data-type="string" property="v-s:subjectCode" class="-view edit search"></veda-control>
      </div>
    </div>
    <hr class="view -edit -search">
    <div class="row">
      <div class="col-sm-6">
        <em about="v-s:hasChief" property="rdfs:label"></em>
        <div rel="v-s:hasChief" class="view -edit search" data-template="v-ui:LabelTemplate"></div>
        <veda-control data-type="link" rel="v-s:hasChief" class="-view edit search fulltext"></veda-control>
        <em about="v-s:hasFieldChief" property="rdfs:label"></em>
        <div rel="v-s:hasFieldChief" class="view -edit search" data-template="v-ui:LabelTemplate"></div>
        <veda-control data-type="link" rel="v-s:hasFieldChief" class="-view edit search fulltext"></veda-control>
      </div>
      <div class="col-sm-6">
        <em about="v-s:hasFunctionalChief" property="rdfs:label"></em>
        <div rel="v-s:hasFunctionalChief" class="view -edit search" data-template="v-ui:LabelTemplate"></div>
        <veda-control data-type="link" rel="v-s:hasFunctionalChief" class="-view edit search fulltext"></veda-control>
      </div>
    </div>
    <hr class="view -edit -search">
    <em about="v-s:postalAddress" property="rdfs:label"></em>
    <div property="v-s:postalAddress" class="view -edit -search"></div>
    <veda-control data-type="text" rows="3" property="v-s:postalAddress" class="-view edit search"></veda-control>
  </div>

  <hr>
  <div about="@" data-template="v-ui:SystemPropertiesTemplate" data-embedded="true"></div>
  <br>
  <!-- BUTTONS -->
  <div class="actions">
    <span about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete journal"></span>
  </div>
</div>
<script>
  // if (individual.isNew()) {
  //   individual.one('beforeSave', function(){
  //     var orgINN = individual['v-s:parentOrganization'][0]['v-s:taxId'][0];
  //     if (orgINN.match('^([0-9]{10}|[0-9]{12})$')) {
  //       orgINN = 'RU'+orgINN;
  //     };
  //     individual.id = 'd:'+orgINN+'_department_'+individual['v-s:subjectCode'][0].toString();
  //   });
  // }
//# sourceURL=v-s:DepartmentTemplate_post
</script>
  """ ;
.

v-s:AppointmentTemplate
  rdf:type v-ui:ClassTemplate ;
  v-ui:forClass v-s:Appointment ;
  rdfs:label "Шаблон для класса v-s:Appointment"@ru ;
  rdfs:label "Template for v-s:Appointment class"@en ;
  v-ui:template """
<script>
  
</script>
<div class="container sheet">
  <h2>
    <span about="v-s:Appointment" property="rdfs:label"></span>
    <!-- <small about="@" property="rdfs:label"></small> -->
  </h2>
  <hr>
  <div class="form-inline">
    <div class="form-group">
      <label about="v-s:parentUnit" property="rdfs:label"></label>:
      <span about="@" property="v-s:parentUnit" data-template="v-ui:LabelTemplate"></span>
    </div>
  </div>
  <div class="form-inline">
    <div class="form-group" about="@" rel="v-s:employee">
      <label about="v-s:employee" property="rdfs:label"></label>:
      <span class="view -edit -search">
        <span about="@" property="rdfs:label"></span>
        <span about="@" property="v-s:tabNumber"></span>
      </span>
    </div>
  </div>
  <div class="form-inline">
    <div class="form-group" about="@" rel="v-s:occupation">
      <label about="v-s:occupation" property="rdfs:label"></label>:
      <span class="view -edit -search">
        <span about="@" property="rdfs:label"></span>
        <span about="@" property="v-s:parentOrganization" data-template="v-ui:LabelTemplate"></span>
      </span>
    </div>
  </div>
  <hr>
  <!-- BUTTONS -->
  <div class="actions">
    <span about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="delete"></span>
  </div>
</div>
<script></script>
  """
.
v-s:NewAppointmentTemplate
  rdf:type v-ui:ClassTemplate ;
  v-ui:forClass v-s:Appointment ;
  rdfs:label "Шаблон для класса v-s:Appointment"@ru ;
  rdfs:label "Template for v-s:Appointment class"@en ;
  v-ui:template """
<script>
  template.on('validate', function() {
    var result = {};
    result["v-s:employee"] = {
      state: individual.hasValue('v-s:employee'),
      cause: ["v-ui:minCardinality"]
    };
    result["v-s:occupation"] = {
      state: individual.hasValue('v-s:occupation'),
      cause: ["v-ui:minCardinality"]
    };
    template.trigger("validated", result);
  });
  template.on("special-validate", function (e, validStates) {
    setTimeout(function(){
      // console.log($('div.validating-block:not(.hide) veda-control.has-error', template));
      if ($('div.validating-block:not(.hide) .has-error', template).length == 0) {
        $('.action#save', template).removeAttr('disabled');
      } else {
        $('.action#save', template).attr('disabled', 'disabled');
      }
    },500);
  });

  var parentOrganization = "unknown";
  if (individual.hasValue("v-s:parentOrganization")) { 
    parentOrganization = individual['v-s:parentOrganization'][0].id;
  }
  var personQueryPrefixString;
  if (individual.hasValue("v-s:employee")) {
    $(".disabling", template).attr("disabled", "disabled");
    personQueryPrefixString = "'@'==='"+individual["v-s:employee"][0].id+"'";
  } else {
    personQueryPrefixString = "'rdf:type'=='v-s:Person' && 'v-s:parentOrganization'=='"+parentOrganization+"'";
  }
  $('#select-Person veda-control', template).attr('data-query-prefix', personQueryPrefixString);
  
  function parentUnitHandler() {
    if (individual.hasValue('v-s:parentUnit')) {
      var parentUnit = individual['v-s:parentUnit'][0].id;
      var occupQueryPrefixString = "'rdf:type'=='v-s:Position' && 'v-s:parentUnit'=='"+parentUnit+"'";
      var tmpl = $('<div><veda-control data-type="link" rel="v-s:occupation" class="fulltext dropdown margin-sm"></veda-control></div>');
      var container = $("#select-Occupation", template);
      container.empty();
      tmpl.children().first().attr('data-query-prefix', occupQueryPrefixString);
      individual.present(container, tmpl.get(0), 'edit');
      template.trigger("validate");
    } else {
      var parentUnitQueryPrefix = "('rdf:type'=='v-s:Department' && 'v-s:parentOrganization'=='"+parentOrganization+"') || '@'==='"+parentOrganization+"'";
      $("#select-ParentUnit", template).attr('data-query-prefix', parentUnitQueryPrefix);  
    }
  }
  parentUnitHandler();
  individual.on("v-s:parentUnit", parentUnitHandler);
  template.one("remove", function(){
    individual.off("v-s:parentUnit", parentUnitHandler);
  })
  
//# sourceURL=v-s:NewAppointmentTemplate_pre
</script>
<div class="container sheet">
  <h2>
    <span about="v-s:Appointment" property="rdfs:label"></span>
    <small about="@" property="rdfs:label"></small>
  </h2>
  <hr>
  <div id="mainProperties">
    <em about="v-s:parentUnit" property="rdfs:label"></em>
    <div about="@" property="v-s:parentUnit" class="view edit -search" data-template="v-ui:LabelLinkTemplate"></div>
    <veda-control id="select-ParentUnit" rel="v-s:parentUnit" data-type="link" class="-view edit search fulltext dropdown"></veda-control>
    <hr class="view -edit -search">
    <div class="row">
      <div class="col-md-6">
        <em about="v-s:employee" property="rdfs:label"></em>
        <div class="btn-group">
          <button id="selectPersonBtn" class="btn btn-sm btn-primary navbar-btn disabling">Выбрать</button>
          <button id="createPersonBtn" class="btn btn-sm btn-default navbar-btn disabling">Создать</button>
        </div>
        <div id="select-Person" class="validating-block">
          <veda-control data-type="link" rel="v-s:employee" class="fulltext dropdown margin-sm"></veda-control>
        </div>
        <div id="fill-Person" class="validating-block"></div>
      </div>
      <div class="col-md-6">
        <em about="v-s:occupation" property="rdfs:label"></em>
        <div class="btn-group">
          <button id="selectOccupationBtn" class="btn btn-sm btn-primary navbar-btn">Выбрать</button>
          <button id="createOccupationBtn" class="btn btn-sm btn-default navbar-btn">Создать</button>
        </div>
        <div id="select-Occupation" class="validating-block">
          <veda-control data-type="link" rel="v-s:occupation" class="fulltext dropdown margin-sm"></veda-control>
        </div>
        <div id="fill-Occupation" class="validating-block"></div>
      </div>
    </div>
    <div id="radioBlock" class="hide">
      <em>Основное назначение</em>
      <div class="radio">
    </div>
  </div>
  <hr>
  <br>
  <!-- BUTTONS -->
  <div class="actions">
    <span about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="save cancel"></span>
  </div>
</div>
<script>
  var NewPerson = null;
  var NewOccupation = null;

  var defaultAppointment = undefined;
  template.on('click', '#radioBlock input[type="radio"]', function(){
    //console.log($(this).attr('value'));
    defaultAppointment = $(this).attr('value');
  });

  function toogleButtons(currentBtn) {
    currentBtn.siblings().removeClass('btn-primary').addClass('btn-default')
    currentBtn.removeClass('btn-default').addClass('btn-primary');
    template.trigger('special-validate');
  }

  $('#createPersonBtn', template).click(function(){
    var self = $(this);
    if (self.hasClass('btn-primary')) return false;
    toogleButtons(self);
    $('#radioBlock').addClass('hide');
    defaultAppointment = undefined;
    $('#select-Person').addClass('hide');
    if (NewPerson) {
      $('#fill-Person').removeClass('hide');
    } else {
      NewPerson = new veda.IndividualModel();
      NewPerson['rdf:type'] = [new veda.IndividualModel('v-s:Person')];
      NewPerson['v-s:parentOrganization'] = individual['v-s:parentOrganization'];
      var tmpl = NewPerson.present($("<div>"), 'v-s:EmployeeEmbeddedTemplate', 'edit');
      tmpl.on("validate", function () {
        template.trigger('special-validate');
      });
      $('#fill-Person').append(tmpl);
    }
    individual['v-s:employee'] = [NewPerson];
  });

  $('#selectPersonBtn').click(function (){
    var self = $(this);
    if (self.hasClass('btn-primary')) return false;
    toogleButtons(self);
    // $('#radioBlock').toggleClass('hide');
    defaultAppointment = undefined;
    $('#select-Person').removeClass('hide');
    $('#fill-Person').addClass('hide');
    individual['v-s:employee'] = [];
    individual.on('v-s:employee', setDefaultAppointment);
  });

  $('#createOccupationBtn', template).click(function(){
    var self = $(this);
    if (self.hasClass('btn-primary')) return false;
    toogleButtons(self);
    individual.off('v-s:employee', setDefaultAppointment);
    $('#select-Occupation').addClass('hide');
    if (NewOccupation) {
      $('#fill-Occupation').removeClass('hide');
    } else {
      NewOccupation = new veda.IndividualModel();
      NewOccupation['rdf:type'] = [new veda.IndividualModel('v-s:Position')];
      NewOccupation['v-s:parentOrganization'] = individual['v-s:parentOrganization'];
      NewOccupation['v-s:parentUnit'] = individual['v-s:parentUnit'];
      var tmpl = NewOccupation.present($("<div>"), 'v-s:OccupationEmbeddedTemplate', 'edit');
      tmpl.on("validate", function () {
        template.trigger('special-validate');
      });
      $('#fill-Occupation').append(tmpl);
    }
    individual['v-s:occupation'] = [NewOccupation];
  });

  $('#selectOccupationBtn').click(function (){
    var self = $(this);
    if (self.hasClass('btn-primary')) return false;
    toogleButtons(self);
    $('#select-Occupation').removeClass('hide');
    $('#fill-Occupation').addClass('hide');
    individual['v-s:occupation'] = [];
  });

  function setDefaultAppointment(){
    var radioCont = $('.radio', template).empty();
    if (individual.hasValue('v-s:employee')) {
      var employeeId = individual['v-s:employee'][0].id;
      var queryString = "'rdf:type'=='v-s:Appointment' && 'v-s:employee'=='"+employeeId+"' && 'v-s:parentOrganization'=='"+individual['v-s:parentOrganization'][0].id+"'";
      var appointments = query({ticket: veda.ticket, query: queryString}).result;
      if (appointments.length > 0) {
        appointments.forEach(function(appointUri) {
          var label = $('<label></label>');
          var radio = $('<input type="radio" name="defaultAppointment"/>').attr('value', appointUri);
          label.append(radio);
          label.append( (new veda.IndividualModel(appointUri))['rdfs:label'][0] );
          radioCont.append($('<div class="radio"></div>').append(label));
        })
        var newAppointLabel = individual['v-s:employee'][0]['rdfs:label'][0];
        radioCont.append('<div class="radio"><label><input type="radio" checked name="defaultAppointment"/>Новое для '+newAppointLabel+'</label></div>');
        $('#radioBlock').removeClass('hide');
        return;
      }
    }
    $('#radioBlock').addClass('hide');

  }

  setDefaultAppointment();
  individual.on('v-s:employee', setDefaultAppointment);
  template.one('remove', function(){
    individual.off('v-s:employee', setDefaultAppointment);
  })

  function beforeSaveHandler(){
    var orgINN = individual['v-s:parentOrganization'][0]['v-s:taxId'][0];
    if (orgINN.match('^([0-9]{10}|[0-9]{12})$')) {
      orgINN = 'RU'+orgINN;
    };
    var occupationCode = individual['v-s:occupation'][0]['v-s:subjectCode'][0];
    var personTabNumber = individual['v-s:employee'][0]['v-s:tabNumber'][0];
    var tempEmployee = individual['v-s:employee'][0];
    var tempOccupation = individual['v-s:occupation'][0];
    if (tempOccupation.isNew()) {
      tempOccupation['v-s:parentUnit'] = individual['v-s:parentUnit'];
      tempOccupation['v-s:parentOrganization'] = individual['v-s:parentOrganization'];
      tempOccupation.save();
      individual['v-s:occupation'] = [tempOccupation];
    }

    if (defaultAppointment){
      tempEmployee['v-s:defaultAppointment'] = [new veda.IndividualModel(defaultAppointment)]
    } else {
      tempEmployee['v-s:defaultAppointment'] = [individual];
    }
    tempEmployee['v-s:hasAppointment'] = tempEmployee['v-s:hasAppointment'].concat(individual);
    if (tempEmployee.isNew()) {
      tempEmployee['v-s:parentOrganization'] = individual['v-s:parentOrganization'];
      tempEmployee.save();
    }
    individual['v-s:employee'] = [tempEmployee];
    return false;
  }
  individual.one('beforeSave', beforeSaveHandler);
  //# sourceURL=v-s:NewAppointmentTemplate_post
</script>
  """ ;
.

v-s:EmployeeEmbeddedTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса v-s:Person при создании v-s:Appoinment"@ru ;
  rdfs:label "Template for v-s:Person to create v-s:Appointment class"@en ;
  v-ui:template """
<script>
  template.on("validate", function () {
    var result = {};
    if (individual.hasValue('v-s:lastName') && individual.hasValue('v-s:firstName')) {
      var queryString = "'rdf:type'==='v-s:Person' && 'v-s:parentOrganization'=='"+individual['v-s:parentOrganization'][0].id+"' && 'v-s:lastName'=='"+individual['v-s:lastName'][0]+"' && 'v-s:firstName'=='"+individual['v-s:firstName'][0]+"'";
      var tmp = query(veda.ticket, queryString).result;
      if (tmp.length == 0) {
        $('#warningPerson').addClass('hide');
      } else {
        $('#warningPerson').removeClass('hide');
      }
    }

    if (!individual.hasValue('v-s:tabNumber')) {
      result["v-s:tabNumber"] = {
        state: false,
        cause: ["v-ui:minCardinality"]
      };
    }
    template.trigger("validated", result);
  });
</script>
<div>
  <div id="warningPerson" class="alert alert-warning hide">
    <span>Внимание. Пользователь с такими ФИО уже существует. Возможно Вам следует выбрать его.</span>
  </div>
  <div class="row">
    <div class="col-md-6">
      <em about="v-s:lastName" property="rdfs:label"></em>
    </div>
    <div class="col-md-6">
      <veda-control data-type="string" property="v-s:lastName"></veda-control>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-md-6">
      <em about="v-s:firstName" property="rdfs:label"></em>
    </div>
    <div class="col-md-6">
      <veda-control data-type="string" property="v-s:firstName"></veda-control>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-md-6">
      <em about="v-s:middleName" property="rdfs:label"></em>
    </div>
    <div class="col-md-6">
      <veda-control data-type="string" property="v-s:middleName"></veda-control>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-md-6">
      <em about="v-s:birthday" property="rdfs:label"></em>
    </div>
    <div class="col-md-6">
      <veda-control data-type="date" property="v-s:birthday"></veda-control>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-md-6">
      <em about="v-s:tabNumber" property="rdfs:label"></em>
    </div>
    <div class="col-md-6">
      <veda-control data-type="string" property="v-s:tabNumber"></veda-control>
    </div>
  </div>
</div>
  """ ;
.

v-s:OccupationEmbeddedTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса v-s:Position при создании v-s:Appoinment"@ru ;
  rdfs:label "Template for v-s:Position to create v-s:Appointment class"@en ;
  v-ui:template """
<script>
  template.on("validate", function () {
    var result = {};
    if (!individual.hasValue('v-s:subjectCode')) {
      result["v-s:subjectCode"] = {
        state: false,
        cause: ["v-ui:minCardinality"]
      };
    }
    if (!individual.hasValue('rdfs:label')) {
      result["rdfs:label"] = {
        state: false,
        cause: ["v-ui:minCardinality"]
      };
    } else {
      var queryString = "'rdf:type'==='v-s:Position' && 'v-s:parentOrganization'=='"+individual['v-s:parentOrganization'][0].id+"' && 'rdfs:label'=='"+individual['rdfs:label'][0]+"' && 'v-s:parentUnit'=='"+individual['v-s:parentUnit'][0].id+"'";
      console.log(queryString)
      var tmp = query(veda.ticket, queryString).result;
      if (tmp.length == 0) {
        $('#warningOccupation').addClass('hide');
      } else {
        $('#warningOccupation').removeClass('hide');
      }
    }
    template.trigger("validated", result);
  });
</script>
<div>
  <div id="warningOccupation" class="alert alert-warning hide">
    <span>Внимание. Должность с похожим названием уже существует в выбранном подразделении. Возможно Вам следует использовать ее.</span>
  </div>
  <div class="row">
    <div class="col-md-6">
      <em about="v-s:title" property="rdfs:label"></em>
    </div>
    <div class="col-md-6">
      <div property="rdfs:label" class="view -edit search"></div>
      <veda-control data-type="string" property="rdfs:label" class="-view edit search"></veda-control>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-md-6">
      <em about="v-s:PositionCode" property="rdfs:label"></em>
    </div>
    <div class="col-md-6">
      <div property="v-s:subjectCode" class="view -edit search"></div>
      <veda-control data-type="string" property="v-s:subjectCode" class="-view edit search"></veda-control>
    </div>
  </div>
</div>
  """ ;
.
