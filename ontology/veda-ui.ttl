@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix v-s: <http://semantic-machines.com/veda/veda-schema/> .
@prefix v-wf: <http://semantic-machines.com/veda/veda-workflow/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix td: <http://semantic-machines.com/veda/test-data/> .
@prefix d: <http://semantic-machines.com/veda/veda-data/> .

@prefix v-ui: <http://semantic-machines.com/veda/veda-ui/> .
<http://semantic-machines.com/veda/veda-ui>
  rdf:type owl:Ontology ;
  rdfs:label "Онтология пользовательского интерфейса системы Веда"@ru ;
  rdfs:label "Veda system user interface ontology"@en ;
#  owl:versionInfo "3.4" ;
  v-s:loadPriority 8 ;
.
v-ui:AvailableLanguage
  rdf:type rdfs:Resource ;
  rdf:value v-ui:RU, v-ui:EN ;
  rdfs:label "Доступный язык"@ru ;
  rdfs:label "Available language"@en ;
.
v-ui:DefaultLanguage
  rdf:type rdfs:Resource ;
  rdf:value v-ui:RU ;
  rdfs:label "Язык по-умолчанию"@ru ;
  rdfs:label "Default language"@en ;
.
v-ui:EN
  rdf:type v-ui:Language ;
  rdfs:label "Eng"^^xsd:string ;
  rdf:value "EN" ;
.
v-ui:RU
  rdf:type v-ui:Language ;
  rdfs:label "Рус"^^xsd:string ;
  rdf:value "RU" ;
.
v-ui:preferredLanguage
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:Preferences ;
  rdfs:label "Предпочитаемый язык"@ru ;
  rdfs:label "Preferred language"@en ;
  rdfs:range v-ui:Language ;
.
v-ui:forClass
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ClassTemplate ;
  rdfs:domain v-ui:ClassModel ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Для класса"@ru ;
  rdfs:label "For class"@en ;
  rdfs:range owl:Class ;
.
v-ui:forProperty
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Для свойства"@ru ;
  rdfs:label "For property"@en ;
  rdfs:range owl:DatatypeProperty, owl:ObjectProperty, rdf:Property ;
.
v-ui:hasTemplate
  rdf:type owl:ObjectProperty ;
  rdfs:domain rdfs:Resource ;
  rdfs:label "Шаблон"@ru ;
  rdfs:label "Template"@en ;
  rdfs:range v-ui:ClassTemplate ;
.
v-ui:hasModel
  rdf:type owl:ObjectProperty ;
  rdfs:domain rdfs:Resource ;
  rdfs:label "Модель"@ru ;
  rdfs:label "Model"@en ;
  rdfs:range v-ui:ClassModel ;
.
v-ui:ClassModel
  rdf:type owl:Class ;
  rdfs:subClassOf v-s:SystemThing ;
  rdfs:label "Модель класса"@ru ;
  rdfs:label "Class model"@en ;
  v-ui:hasTemplate v-ui:ClassModelTemplate ;
.
v-ui:template
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:ClassTemplate ;
  rdfs:label "Шаблон"@ru ;
  rdfs:label "Template"@en ;
  rdfs:range xsd:string ;
.
v-ui:ClassTemplate
  rdf:type owl:Class ;
  rdfs:subClassOf v-s:SystemThing ;
  rdfs:label "Шаблон"@ru ;
  rdfs:label "Template"@en ;
  v-ui:hasTemplate v-ui:ClassTemplateTemplate ;
.
v-ui:PropertySpecification
  rdf:type owl:Class ;
  rdfs:subClassOf v-s:SystemThing ;
  rdfs:label "Спецификация свойства"@ru ;
  rdfs:label "Property specification"@en ;
  v-ui:hasTemplate v-ui:PropertySpecificationTemplate ;
.
v-ui:tooltip
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Подсказка"@ru ;
  rdfs:label "Tooltip"@en ;
  rdfs:range xsd:string ;
.
v-ui:alternativeName
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Альтернативное наименование предиката"@ru ;
  rdfs:label "Alternative name for predicate"@en ;
  rdfs:range xsd:string ;
.
v-ui:placeholder
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Заполнитель"@ru ;
  rdfs:label "Placeholder"@en ;
  rdfs:range xsd:string ;
.
v-ui:minCardinality
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Минимальная кардинальность"@ru ;
  rdfs:label "Minimal cardinality"@en ;
  rdfs:comment "Значений меньше чем требуется"@ru ;
  rdfs:comment "Less values than required"@en ;
  rdfs:range xsd:integer ;
.
v-ui:maxCardinality
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Максимальная кардинальность"@ru ;
  rdfs:label "Maximal cardinality"@en ;
  rdfs:comment "Значений больше чем требуется"@ru ;
  rdfs:comment "More values than required"@en ;
  rdfs:range xsd:integer ;
.
v-ui:defaultValue
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Значение по-умолчанию"@ru ;
  rdfs:label "Default value"@en ;
  rdfs:range rdfs:Resource ;
.
v-ui:optionValue
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:PropertySpecification ;
  rdfs:label "Допустимое значение"@ru ;
  rdfs:label "Option value"@en ;
  rdfs:range rdfs:Resource ;
.
v-ui:DatatypePropertySpecification
  rdf:type owl:Class ;
  rdfs:subClassOf v-ui:PropertySpecification ;
  rdfs:label "Спецификация литерального свойства"@ru ;
  rdfs:label "Datatype property specification"@en ;
  v-ui:hasTemplate v-ui:DatatypePropertySpecificationTemplate ;
.
v-ui:regexp
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:DatatypePropertySpecification ;
  rdfs:label "Регулярное выражение"@ru ;
  rdfs:label "Regular expression"@en ;
  rdfs:comment "Значение не соответствует регулярному выражению"@ru ;
  rdfs:comment "Value does not match the regular expression"@en ;
  rdfs:range xsd:string ;
.
v-ui:minValue
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:DatatypePropertySpecification ;
  rdfs:label "Минимальное значение"@ru ;
  rdfs:label "Minimal value"@en ;
  rdfs:comment "Значение меньше минимума"@ru ;
  rdfs:comment "Value is less than minimum"@en ;
  rdfs:range rdfs:Resource ;
.
v-ui:maxValue
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:DatatypePropertySpecification ;
  rdfs:label "Максимальное значение"@ru ;
  rdfs:label "Maximal value"@en ;
  rdfs:comment "Значение больше максимума"@ru ;
  rdfs:comment "Value is greater than maximum"@en ;
  rdfs:range rdfs:Resource ;
.
v-ui:minLength
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:DatatypePropertySpecification ;
  rdfs:label "Минимальная длина строки"@ru ;
  rdfs:label "Minimal string length"@en ;
  rdfs:comment "Длина строки меньше допустимой"@ru ;
  rdfs:comment "String length is less than allowed"@en ;
  rdfs:range xsd:integer ;
.
v-ui:maxLength
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:DatatypePropertySpecification ;
  rdfs:label "Максимальная длина строки"@ru ;
  rdfs:label "Maximal string length"@en ;
  rdfs:comment "Длина строки больше допустимой"@ru ;
  rdfs:comment "String length is greater than allowed"@en ;
  rdfs:range xsd:integer ;
.
v-ui:ObjectPropertySpecification
  rdf:type owl:Class ;
  rdfs:subClassOf v-ui:PropertySpecification ;
  rdfs:label "Спецификация объектного свойства"@ru ;
  rdfs:label "Object property specification"@en ;
  v-ui:hasTemplate v-ui:ObjectPropertySpecificationTemplate ;
.
v-ui:rangeRestriction
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Ограничение области значений"@ru ;
  rdfs:label "Range restriction"@en ;
  rdfs:range owl:Class ;
  rdfs:range rdfs:Class ;
.
v-ui:queryPrefix
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Префикс запроса"@ru ;
  rdfs:label "Query prefix"@en ;
  rdfs:range xsd:string ;
.
v-ui:sort
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Сортировка"@ru ;
  rdfs:label "Sorting"@en ;
  rdfs:range xsd:string ;
.
v-ui:treeRoot
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Корень"@ru ;
  rdfs:label "Root"@en ;
  rdfs:range rdfs:Resource ;
.
v-ui:treeInProperty
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Входящая ветвь"@ru ;
  rdfs:label "In edge"@en ;
  rdfs:range owl:ObjectProperty ;
.
v-ui:treeOutProperty
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Исходящая ветвь"@ru ;
  rdfs:label "Out edge"@en ;
  rdfs:range owl:ObjectProperty ;
.
v-ui:treeAllowedClass
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Разрешенный класс"@ru ;
  rdfs:label "Allowed class"@en ;
  rdfs:range owl:Class ;
  rdfs:range rdfs:Class ;
.
v-ui:treeSelectableClass
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Выбираемый класс"@ru ;
  rdfs:label "Selectable class"@en ;
  rdfs:range owl:Class ;
  rdfs:range rdfs:Class ;
.
v-ui:treeSelectableFilter
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Фильтр выбираемых субъектов"@ru ;
  rdfs:label "Selectable filter"@en ;
  rdfs:range xsd:string ;
.
v-ui:treeDisplayedProperty
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-ui:ObjectPropertySpecification ;
  rdfs:label "Отображаемое свойство"@ru ;
  rdfs:label "Displayed property"@en ;
  rdfs:range owl:ObjectProperty ;
  rdfs:range owl:DatatypeProperty ;
.
v-ui:Language
  rdf:type owl:Class ;
  rdfs:subClassOf v-s:SystemThing ;
  rdfs:label "Язык"@ru ;
  rdfs:label "Language"@en ;
.
v-ui:Preferences
  rdf:type owl:Class ;
  rdfs:subClassOf v-s:SystemThing ;
  rdfs:subClassOf v-s:Embedded ;
  rdfs:label "Предпочтения"@ru ;
  rdfs:label "Preferences"@en ;
.
v-ui:hasPreferences
  rdf:type owl:ObjectProperty ;
  rdfs:domain v-s:Person ;
  rdfs:label "Предпочтения"@ru ;
  rdfs:label "Preferences"@en ;
  rdfs:range v-ui:Preferences ;
.
v-ui:displayedElements
  rdf:type owl:DatatypeProperty ;
  rdfs:domain v-ui:Preferences ;
  rdfs:label "Отображать элементов"@ru ;
  rdfs:label "Display elements"@en ;
  rdfs:range xsd:nonNegativeInteger ;
.

# --------------- System properties template ------------------

v-ui:LanguageSwitchTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон переключения языка"@ru ;
  rdfs:label "Language switch template"@en ;
  v-ui:template """
<div about="@" class="btn-group" rel="rdf:value">
  <button about="@" property="rdfs:label" class="btn btn-xs btn-default navbar-btn"></button>
  <script>
    function handler() {
      var preferred = veda.user.preferences["v-ui:preferredLanguage"];
      if ( preferred.indexOf(individual) >= 0) {
        template.addClass("active btn-success").removeClass("btn-default");
      } else {
        template.removeClass("active btn-success").addClass("btn-default");
      }
    }
    handler();
    template.click(function (e) {
      e.stopPropagation();
      var langValue = individual["rdf:value"][0].toString();
      veda.user.toggleLanguage(langValue);
      handler();
    });
    //# sourceURL=v-ui:LanguageButtonTemplate
  </script>
</div>
  """
.

v-ui:SystemPropertiesTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с набором системных свойств"@ru ;
  rdfs:label "Template with system properties"@en ;
  v-ui:template """
<div>
  <h3 about="v-s:SystemProperties" property="rdfs:label"></h3>
  <div class="row">
    <div class="col-md-3 col-xs-6">
      <em about="v-s:creator" property="rdfs:label"></em>
      <veda-control data-type="link" rel="v-s:creator" class="-view -edit search fulltext"></veda-control>
      <div about="@" rel="v-s:creator" data-template="v-ui:LabelTemplate" class="view edit -search"></div>
      <div rel="v-s:creator" data-template="v-ui:LabelTemplate" class="-view -edit search"></div>
    </div>
    <div class="col-md-3 col-xs-6">
      <em about="v-s:created" property="rdfs:label"></em>
      <veda-control property="v-s:created" data-type="date" class="-view -edit search"></veda-control>
      <div about="@" property="v-s:created" class="view edit -search"></div>
      <div property="v-s:created" class="-view -edit search"></div>
    </div>
    <div class="col-md-3 col-xs-6">
      <em about="v-s:lastEditor" property="rdfs:label"></em>
      <veda-control data-type="link" rel="v-s:lastEditor" class="-view -edit search fulltext"></veda-control>
      <div about="@" rel="v-s:lastEditor" data-template="v-ui:LabelTemplate" class="view edit -search"></div>
      <div rel="v-s:lastEditor" data-template="v-ui:LabelTemplate" class="-view -edit search"></div>
    </div>
    <div class="col-md-3 col-xs-6">
      <em about="v-s:edited" property="rdfs:label"></em>
      <veda-control data-type="date" property="v-s:edited" class="-view -edit search"></veda-control>
      <div about="@" property="v-s:edited" class="view edit -search"></div>
      <div property="v-s:edited" class="-view -edit search"></div>
    </div>
  </div>
</div>
""" ;
.
v-ui:StandardButtonsTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с набором стандартных кнопок"@ru ;
  rdfs:label "Template with standard buttons"@en ;
  v-ui:template """
<script>
  // var allButtons = "send edit save cancel delete destroy journal journal-dms task";
  var defaultButtons = "send edit save cancel delete journal task";
  individual.rights.then(function (rights) {
    var canUpdate = rights.hasValue("v-s:canUpdate", true);
    var canDelete = rights.hasValue("v-s:canDelete", true);
    var enabledButtons = (container.data("buttons") || defaultButtons).split(" ");
    enabledButtons.forEach(function (id) {
      if ( !canUpdate && (id === "save" || id === "edit" || id === "cancel") ) { return; }
      if ( !canDelete && (id === "delete") ) { return; }
      $("#" + id, template).removeClass("rm");
    });
    $(".rm", template).remove();
  });

  template.on("click", "#edit, #save, #cancel, #delete, #destroy", function (e) {
    e.preventDefault();
    var action = this.id;
    if (action === "delete" || action === "destroy") {
      var warning = new veda.IndividualModel("v-s:AreYouSure")["rdfs:label"].join(" ");
      if ( !confirm(warning) ) { return; }
    }
    template.parent().closest("[resource]").trigger(action);
  });
  $("#journal", template).on("click", function (e) {
    e.preventDefault();
    var journal_uri = individual.id + "j",
        journal = new veda.IndividualModel(journal_uri);
    if (journal.hasValue("rdf:type") && journal["rdf:type"][0].id !== "rdfs:Resource") {
      riot.route("#/" + journal_uri);
    } else {
      var journalEmpty = new veda.IndividualModel("v-s:JournalEmpty")["rdfs:label"].join(" ");
      alert(journalEmpty);
    }
  });
  $("#journal-dms", template).on("click", function (e) {
    var uri = individual.id.substring(2,100);
    var journalDMS_url = (new veda.IndividualModel("cfg:JournalDMSUrl"))["rdf:value"][0];
    if (journalDMS_url) {
      window.open(journalDMS_url + uri, "journal-dms");
    }
  });
  $("#send", template).on("click", function () {
    template.parent().closest("[resource]").trigger("save");
    veda.Util.send(individual, template);
  });
  $("#createReport", template).on("click", function () { veda.Util.createReport(individual); });
  $("#showRights", template).on("click", function () { veda.Util.showRights(individual); });

  // Standard tasks
  template.on("click", "ul#standard-tasks a", function (e) {
    e.preventDefault();
    var task = $(this).attr("about");
    if (task === "v-s:Question") {
      veda.Util.send(individual, template, 'v-wf:questionRouteStartForm', true);
    } else if (task === "v-s:Instruction") {
      veda.Util.send(individual, template, 'v-wf:instructionRouteStartForm', true);
    } else if (task === "v-s:Introduction") {
      veda.Util.send(individual, template, 'v-wf:taskRouteStartForm', true);
    } else if (task === "v-s:Distribution") {
      veda.Util.send(individual, template, 'v-wf:distributionRouteStartForm', true);
    } else if (task === "v-s:Coordination") {
      veda.Util.send(individual, template, 'v-wf:coordinationRouteStartForm', true);
    } else if (task === "v-s:Sign") {
      veda.Util.send(individual, template, 'v-wf:signRouteStartForm', true);
    }
  });

  //# sourceURL=v-ui:StandardButtonsTemplate_pre
</script>
<div class="standard-actions">
  <style>
    .standard-actions {
      margin: 0 3px 0 0;
    }
  </style>
  <button type="submit" class="rm action btn btn-warning view edit -search" id="send" about="v-s:Send" property="rdfs:label"></button>
  <button type="button" class="rm action btn btn-primary view -edit -search" id="edit" about="v-s:Edit" property="rdfs:label"/>
  <button type="submit" class="rm action btn btn-success -view edit -search" id="save" about="v-s:Save" property="rdfs:label"/>
  <button type="button" class="rm action btn btn-default -view edit -search" id="cancel" about="v-s:Cancel" property="rdfs:label"/>
  <button type="button" class="rm action btn btn-link view edit -search" id="delete" about="v-s:Delete" property="rdfs:label"/>
  <button type="button" class="rm action btn btn-danger view edit -search" id="destroy" about="v-s:Destroy" property="rdfs:label"/>
  <button type="button" class="rm action btn btn-default view -edit -search" id="journal" about="v-s:ViewJournal" property="rdfs:label"/>
  <button type="button" class="rm action btn btn-default view -edit -search" id="journal-dms" about="v-s:ViewJournalDMS" property="rdfs:label"/>
  <div class="rm action btn-group dropup view -edit -search" id="task">
    <button class="action btn btn-warning btn-block dropdown-toggle" id="task-button" data-toggle="dropdown">
      <span about="v-s:SendTask" property="rdfs:label"> </span>
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" id="standard-tasks">
      <li><a href="#" about="v-s:Question" property="rdfs:label"></a></li>
      <li><a href="#" about="v-s:Instruction" property="rdfs:label"></a></li>
      <li><a href="#" about="v-s:Introduction" property="rdfs:label"></a></li>
      <li><a href="#" about="v-s:Distribution" property="rdfs:label"></a></li>
      <li><a href="#" about="v-s:Coordination" property="rdfs:label"></a></li>
      <li><a href="#" about="v-s:Sign" property="rdfs:label"></a></li>
    </ul>
  </div>
</div>
<script>
  // Make position fixed for buttons bar that doesn't fit the window
  function checkOffset(main, actions, actionsStaticHeight, placeholder) {
    var mainTop = main.offset().top;
    var mainHeight = main.height();
    var windowHeight = window.innerHeight;
    var windowTop = window.scrollY || window.pageYOffset;
    var actionsStaticTop = placeholder.offset().top;
    var actions_inside_viewport = windowTop <= actionsStaticTop && actionsStaticTop < (windowTop + windowHeight);
    var main_inside_viewport = windowTop <= (mainTop + mainHeight - actionsStaticHeight) && (mainTop + actionsStaticHeight) < (windowTop + windowHeight);
    if ( !actions_inside_viewport && main_inside_viewport )  {
      if ( !actions.hasClass("actions-fixed") ) {
        placeholder.css("height", actionsStaticHeight);
        actions.addClass("actions-fixed");
      }
    } else {
      if ( actions.hasClass("actions-fixed") ) {
        placeholder.css("height", 0);
        actions.removeClass("actions-fixed");
      }
    }
  }
  setTimeout(function () {
    var main = template.parent().closest("[resource]");
    if (!main.length) { return; }
    var actions = template.closest(".actions");
    if (!actions.length) { return; }
    var actionsStaticHeight = actions.height();
    var placeholder = $("<div></div>").insertBefore(actions);
    checkOffset(main, actions, actionsStaticHeight, placeholder);
    $(window).on("scroll", scrollHandler);
    template.one("remove", function () {
      $(window).off("scroll", scrollHandler);
    });
    function scrollHandler () {
      checkOffset(main, actions, actionsStaticHeight, placeholder);
    }
  }, 500);

  // Respect validation state of parent template
  var closest = template.parent().closest("[resource]");
  closest.on("internal-validated", function (e, validation) {
    if (validation.state) {
      $(".action#save", template).removeAttr("disabled");
      $(".action#send", template).removeAttr("disabled");
      $(".action#task-button", template).removeAttr("disabled");
    } else {
      $(".action#save", template).attr("disabled", "disabled");
      $(".action#send", template).attr("disabled", "disabled");
      $(".action#task-button", template).attr("disabled", "disabled");
    }
    e.stopPropagation();
  });
  //# sourceURL=v-ui:StandardButtonsTemplate_post
</script>
""" ;
.
v-ui:IconButtonsTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с набором стандартных кнопок"@ru ;
  rdfs:label "Template with standard buttons"@en ;
  v-ui:template """
<script>
  // var allButtons = "edit save cancel delete";
  var defaultButtons = "edit save cancel delete";
  individual.rights.then(function (rights) {
    var canUpdate = rights.hasValue("v-s:canUpdate", true);
    var canDelete = rights.hasValue("v-s:canDelete", true);
    var enabledButtons = (container.data("buttons") || defaultButtons).split(" ");
    enabledButtons.forEach(function (id) {
      if ( !canUpdate && (id === "save" || id === "edit" || id === "cancel") ) { return; }
      if ( !canDelete && (id === "delete") ) { return; }
      $("#" + id, template).removeClass("rm");
    });
    $(".rm", template).remove();
  });

  template.on("click", "#edit, #save, #cancel, #delete", function (e) {
    e.preventDefault();
    var action = this.id;
    if (action === "delete") {
      var warning = new veda.IndividualModel("v-s:AreYouSure")["rdfs:label"].join(" ");
      if ( !confirm(warning) ) { return; }
    }
    template.parent().closest("[resource]").trigger(action);
  });
  //# sourceURL=v-ui:IconButtonsTemplate_pre
</script>
<div class="standard-actions">
  <style>
    .standard-actions {
      margin: 0 3px 0 0;
    }
  </style>
  <button data-toggle="tooltip" data-placement="top" data-title="v-s:Edit" type="button" class="action btn btn-xs btn-default view -edit -search glyphicon glyphicon-pencil" id="edit"></button>
  <button data-toggle="tooltip" data-placement="top" data-title="v-s:Save" type="button" class="action btn btn-xs btn-success -view edit -search glyphicon glyphicon-ok" id="save"></button>
  <button data-toggle="tooltip" data-placement="top" data-title="v-s:Cancel" type="button" class="action btn btn-xs btn-default -view edit -search glyphicon glyphicon-repeat" id="cancel"></button>
  <button data-toggle="tooltip" data-placement="top" data-title="v-s:Delete" type="button" class="action btn btn-xs btn-default view edit -search glyphicon glyphicon-remove" id="delete"></button>
</div>
<script>
  $('[data-toggle="tooltip"]').tooltip({
    title: function () {
      var titleUri = $(this).data("title");
      return new veda.IndividualModel(titleUri)["rdfs:label"].join(" ");
    }
  });

  // Respect validation state of parent template
  var closest = template.parent().closest("[resource]");
  closest.on("internal-validated", function (e, validation) {
    if (validation.state) {
      $(".action#save", template).removeAttr("disabled");
    } else {
      $(".action#save", template).attr("disabled", "disabled");
    }
    e.stopPropagation();
  });
  //# sourceURL=v-ui:IconButtonsTemplate_post
</script>
""" ;
.
v-ui:VersionTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса v-s:Version"@ru ;
  rdfs:label "Template for class v-s:Version"@en ;
  v-ui:forClass v-s:Version ;
  v-ui:template """
<div class="alert alert-warning hidden">
  <p>
    <span about="v-s:VersionAlert" property="rdfs:label"></span>
    <span class="pull-right" about="@" rel="v-s:actualVersion">
      <a href="#/@" class="alert-link" about="v-s:actualVersion" property="rdfs:label"></a>
    </span>
  </p>
</div>
<script>
  setTimeout(function () {
    var renderedTemplates = $("[resource$='" + individual.id.substring(2) + "']");
    renderedTemplates.each(function () {
      var renderedTemplate = $(this);
      renderedTemplate.find("a, button").addClass("disabled").attr("disabled", "disabled");
      if ( renderedTemplate.parent().prop("id") === "main" ) {
        var sheet = renderedTemplate.children(".sheet").first();
        template.removeClass("hidden").prependTo(sheet.length ? sheet : renderedTemplate);
      }
    });
  }, 100);
</script>
""" ;
.
v-ui:VersionedTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для отображения версий объекта"@ru ;
  rdfs:label "Template for versions display"@en ;
  v-ui:template """
<div>
  <h3 about="v-s:Versions" property="rdfs:label"></h3>
  <div class="panel panel-default">
    <table class="table table-condensed">
      <thead>
        <tr class="active">
          <th width="1%">#</th>
          <th about="rdfs:label" property="rdfs:label"></th>
          <th about="v-s:created" property="rdfs:label"></th>
          <th about="v-s:creator" property="rdfs:label"></th>
        </tr>
      </thead>
      <tbody id="versions"></tbody>
      <tfoot>
        <tr>
          <td colspan="10" class="clearfix">
            <button class="pull-left btn btn-xs btn-primary glyphicon glyphicon-chevron-down"></button>
            <div class="pull-right">
              <span class="bg-info" style="padding:0px 5px;display: inline-block">Актуальная версия</span>
              <strong>Текущая версия</strong>
            </div>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
<script>
  var actual = individual["v-s:actualVersion"][0];
  if (!actual) { return; }
  var tmpl = ''
    + '<tr>'
      + '<td>#</td>'
      + '<td about="@" data-template="v-ui:LabelLinkTemplate" class="view edit -search"></td>'
      + '<td about="@" property="v-s:created" class="view edit -search"></td>'
      + '<td about="@" rel="v-s:creator" data-template="v-ui:LabelTemplate" class="view edit -search"></td>'
    + '</tr>';
  var tbody = $("#versions", template);
  var btn = $("button", template).click(function () {
    tbody.empty();
    renderVersion(actual, 1, -1);
  });
  renderVersion(actual, 1, 5);

  individual.on("v-s:previousVersion", versionHandler);
  template.one("remove", function () {
    individual.off("v-s:previousVersion", versionHandler);
  });
  function versionHandler() {
    tbody.empty();
    renderVersion(actual, 1, 5);
  }

  function renderVersion(current, counter, limit) {
    if (!current) { return btn.remove(); }
    if (!limit) { return; }
    var previous = current["v-s:previousVersion"][0];
    var row = tmpl.replace("#", counter);
    if (current.id === actual.id) { row = row.replace("<tr>", "<tr class='info'>"); }
    if (current.id === individual.id) { row = row.replace(/td/g, "th").replace("v-ui:LabelLinkTemplate", "v-ui:LabelTemplate"); }
    current.present(tbody, row);
    renderVersion(previous, ++counter, --limit);
  }
  //# sourceURL=v-ui:VersionedTemplate
</script>
""" ;
.

v-ui:IconPersonTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон персоны с иконкой"@ru ;
  rdfs:label "Person template with icon"@en ;
  v-ui:template """
<a href="#/@">
  <!--span class="glyphicon glyphicon-user"></span-->
  <span about="@" property="rdfs:label"></span>
</a>
""" ;
.

v-ui:ImageAppointmentTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон персоны с иконкой"@ru ;
  rdfs:label "Person template with icon"@en ;
  v-ui:template """
<div class="panel panel-default" style="word-wrap:break-word;display:inline-block;margin:7px 7px 0 0;overflow:hidden; max-width:200px; height:125px">
  <div class="panel-body" style="padding:7px;">
    <div about="@" rel="v-s:employee">
      <script>
        individual.hasValue("v-s:hasImage") ? $(".no-image", template).remove() : $(".has-image", template).remove() ;
        //# sourceURL=v-ui:ImageAppointmentTemplate_pre
      </script>
      <div style="width:50px">
        <div class="has-image" about="@" rel="v-s:hasImage" data-template="v-ui:ImageSimpleTemplateWithoutBorder"></div>
        <div class="no-image"><span class="text-muted fa fa-user fa-4x"></span></div>
      </div>
    </div>
    <strong rel="v-s:employee" data-template="v-ui:LabelTemplate"></strong><br>
    <small rel="v-s:occupation" data-template="v-ui:LabelTemplate"></small>
  </div>
</div>
""" ;
.

v-ui:ImageAppointmentFixedTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон персоны с иконкой фиксированного размера"@ru ;
  rdfs:label "Person template with icon"@en ;
  v-ui:template """
<div class="panel panel-default" >
  <div class="panel-body" style="padding:7px;">
    <div class="row">
      <div class="col-md-2">
        <div about="@" rel="v-s:employee">
          <script>
            individual.hasValue("v-s:hasImage") ? $(".no-image", template).remove() : $(".has-image", template).remove() ;
            //# sourceURL=v-ui:ImageAppointmentTemplate_pre
          </script>
          <div style="width:50px">
            <div class="has-image" about="@" rel="v-s:hasImage" data-template="v-ui:ImageSimpleTemplateWithoutBorder"></div>
            <div class="no-image"><span class="text-muted fa fa-user fa-4x"></span></div>
          </div>
        </div>
      </div>
      <div class="col-md-10">
        <strong rel="v-s:employee" data-template="v-ui:LabelTemplate"></strong><br>
        <small rel="v-s:occupation" data-template="v-ui:LabelTemplate"></small>
      </div>
    </div>
  </div>
</div>
""" ;
.

v-ui:PersonAppointmentTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон персоны с выбором назначения"@ru ;
  rdfs:label "Person template with appointment select"@en ;
  v-ui:template """
  <div>
    <veda-control data-type="link" rel="v-s:defaultAppointment" class="fulltext dropdown" data-template="{individual['v-s:occupation'][0]['rdfs:label'].join(', ')}"></veda-control>
  </div>
""" ;
.
v-ui:PS_PersonDefaultAppointment
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация назначения по-умолчанию для класса Персона"@ru ;
  rdfs:label "Default appointment property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-s:defaultAppointment ;
  v-ui:queryPrefix "('rdf:type'==='v-s:Appointment' && 'v-s:employee'=='{individual.id}' && 'v-s:official'=='true')"^^xsd:string ;
.

v-ui:ResourceTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса Ресурс"@ru ;
  rdfs:label "Template for Resource class"@en ;
  v-ui:forClass rdfs:Resource ;
  v-ui:template """
<div class="container sheet">
  <div class="clearfix">
    <h2 class="pull-left"><span about="@" rel="rdf:type" data-template="v-ui:LabelTemplate"></span><small about="@" property="rdfs:label"></small></h2>
    <a class="pull-right" href="#/@"><span property="@"></span></a>
  </div>
</div>
  """ ;
.

v-ui:ResourceSpec
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация типа для класса Resource"@ru ;
  rdfs:label "Type specification for Resource class"@en ;
  v-ui:forClass rdfs:Resource ;
  v-ui:forProperty rdf:type ;
  v-ui:minCardinality "1"^^xsd:integer ;
  v-ui:maxCardinality "10"^^xsd:integer ;
  v-ui:tooltip "Обязательно к заполнению, единственное значение. Ссылка на объект типа Класс."@ru ;
  v-ui:tooltip "Required, single value. Link to object of type Class"@en ;
  v-ui:queryPrefix "('rdf:type'=='owl:Class' || 'rdf:type'=='rdfs:Class')"^^xsd:string ;
.

v-ui:LabelTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с меткой"@ru ;
  rdfs:label "Template with label"@en ;
  v-ui:template """
  <span class="label-template" about="@" property="rdfs:label"></span>
  <script>
    if (!individual.hasValue("rdfs:label")) {
      template.text(individual.id);
    }
    //# sourceURL=v-ui:LabelTemplate
  </script>
  """ ;
.
v-ui:LabelTemplateWithEditLink
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с меткой и ссылкой на страницу редактирования"@ru ;
  rdfs:label "Template with label & edit link"@en ;
  v-ui:template """
  <span class="label-template">
    # <a href="#/@///edit"><span id="label" property="rdfs:label"></span></a>
  </span>
  <script>
    if (!individual.hasValue("rdfs:label")) {
      $("#label", template).text(individual.id);
    }
    //# sourceURL=v-ui:LabelTemplateWithEditLink
  </script>
  """ ;
.
v-ui:LabelLinkTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с меткой и ссылкой"@ru ;
  rdfs:label "Template with label & link"@en ;
  v-ui:template """
  <a class="label-template" href="#/@"><span about="@" property="rdfs:label"></span></a>
  <script>
    if (!individual.hasValue("rdfs:label")) {
      template.text(individual.id);
    }
    //# sourceURL=v-ui:LabelLinkTemplate
  </script>
  """ ;
.

v-ui:IconModalTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с меткой и ссылкой"@ru ;
  rdfs:label "Template with label & link"@en ;
  v-ui:template """
<a href="#" class="glyphicon glyphicon-zoom-in"></a>
<script>
  template.on("click", function (e) {
    e.preventDefault();
    var newMode = "view";
    var parentTmpl = template.parent().closest("[resource]");
    if (parentTmpl.attr("resource") === individual.id) {
      newMode = parentTmpl.data("mode");
    }
    var modal = $("#notification-modal-template").html();
    modal = $(modal).modal({"show": false});
    $("body").append(modal);
    modal.modal("show");
    template.one("remove", function () {
      modal.modal("hide").remove();
    });
    var cntr = $(".modal-body", modal);
    var ok = $("#ok", modal);
    cntr.on("valid", function () {
      ok.removeAttr("disabled");
    });
    cntr.on("invalid", function () {
    ok.attr("disabled", "disabled");
    });

    var tmpl = individual.present(cntr, undefined, newMode);
    if (newMode === "edit") {
      $(".actions", tmpl).remove();
    }
    individual.one("beforeReset", function () {
      modal.modal("hide").remove();
    });
    individual.one("afterSave", function () {
      modal.modal("hide").remove();
    });
  });
  //# sourceURL=v-ui:IconModalTemplate
</script>
  """ ;
.

v-ui:LabelEmptyLinkTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон без имени класса, но с меткой (модальное окно)"@ru ;
  rdfs:label "Template without class name, with label (modal)"@en ;
  v-ui:template """
<a href="#" property="rdfs:label"></a>
<script>
  if (!individual.hasValue("rdfs:label")) {
    template.text(individual.id);
  }
  //# sourceURL=v-ui:LabelEmptyLinkTemplate
</script>
  """ ;
.
v-ui:LabelBlockLinkTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон без имени класса, но с меткой, блочный"@ru ;
  rdfs:label "Template without class name, with label, blocked"@en ;
  v-ui:template """
  <div><a id="label" href="#/@" property="rdfs:label"></a></div>
  <script>
    if (!individual.hasValue("rdfs:label")) {
      $("#label", template).text(individual.id);
    }
    //# sourceURL=v-ui:LabelBlockLinkTemplate
  </script>
  """ ;
.
v-ui:ClassNameLabelLinkTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с именем класса и меткой"@ru ;
  rdfs:label "Template with class name and label"@en ;
  v-ui:template """
  <a class="label-template" href="#/@"><span about="@" rel="rdf:type"><span about="@" property="rdfs:label"></span></span>: <span id="label" about="@" property="rdfs:label"></span></a>
  <script>
    if (!individual.hasValue("rdfs:label")) {
      $("#label", template).text(individual.id);
    }
    //# sourceURL=v-ui:ClassNameLabelLinkTemplate
  </script>
  """ ;
.
v-ui:ClassNameLabelLinkEditTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с именем класса и меткой"@ru ;
  rdfs:label "Template with class name and label"@en ;
  v-ui:template """
  <a class="label-template" href="#/@///edit"><span about="@" rel="rdf:type"><span about="@" property="rdfs:label"></span></span>: <span id="label" about="@" property="rdfs:label"></span></a>
  <script>
    if (!individual.hasValue("rdfs:label")) {
      $("#label", template).text(individual.id);
    }
    //# sourceURL=v-ui:ClassNameLabelLinkTemplate
  </script>
  """ ;
.

v-ui:RabbitHole
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Кроличья нора"@ru ;
  rdfs:label "Rabbit hole"@en ;
  v-ui:template """
<script>
  var defaultProperties = "v-s:parent v-s:backwardTarget";
  var allowedProperties = (container.data("properties") || defaultProperties).split(" ");
  var text = "<span>" + mkLabel(individual) + "</span>";
  var visited = [ individual.id ];

  for (var i = 0, property; (property = allowedProperties[i]); i++ ) {
    if ( individual.hasValue(property) ) {
      travel( individual[property][0] );
      break;
    }
  }
  $("small", template).append(text);

  function travel(individual) {
    if ( visited.indexOf(individual.id) >= 0 ) {
      return;
    } else {
      visited.push(individual.id);
    }
    text = "<a href='#/" + individual.id + "'>" + mkLabel(individual) + "</a>" + " / " + text;
    for (var i = 0, property; (property = allowedProperties[i]); i++ ) {
      if ( individual.hasValue(property) ) {
        travel( individual[property][0] );
        break;
      }
    }
  }
  function mkLabel(individual) {
    return individual["rdf:type"][0]["rdfs:label"].join(" ") + ": " + ( individual.hasValue("rdfs:label") ? individual["rdfs:label"].join(" ") : individual.id )
  }
</script>
<h5><small></small></h5>
  """ ;
.

v-ui:ClassNameLabelTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон с именем класса и меткой"@ru ;
  rdfs:label "Template with class name and label"@en ;
  v-ui:template """
  <span class="label-template"><span about="@" property="rdf:type"></span>: <span id="label" about="@" property="rdfs:label"></span></span>
  <script>
    if (!individual.hasValue("rdfs:label")) {
      $("#label", template).text(individual.id);
    }
    //# sourceURL=v-ui:ClassNameLabelTemplate
  </script>
  """ ;
.
v-ui:SavedSearchTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса Сохраненный запрос"@ru ;
  rdfs:label "Template for Saved search class"@en ;
  v-ui:forClass v-s:SavedSearch ;
  v-ui:template """
  <div>
    <em about="rdfs:label" property="rdfs:label"></em>
    <div property="rdfs:label"></div>
    <em about="v-s:query" property="rdfs:label"></em>
    <div property="v-s:query"></div>
    <br/>
    <div class="actions">
      <div about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete"></div>
    </div>
  </div>
  """ ;
.

v-ui:StatusTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса Статус"@ru ;
  rdfs:label "Template for Status class"@en ;
  v-ui:forClass v-s:Status ;
  v-ui:template """
  <span class="label" property="rdfs:label"></span>
  <script>
    template.addClass("label-"+individual["v-s:tag"]);
  </script>
  """ ;
.

####### TEST UI #######

v-ui:TestUIClass
  rdf:type owl:Class ;
  rdfs:subClassOf v-s:SystemThing ;
  rdfs:label "Класс для тестирования интерфейса"@ru ;
  rdfs:label "Test UI class"@en ;
  v-ui:hasTemplate v-ui:TestUITemplate ;
.

v-ui:testBoolean
  rdf:type owl:DatatypeProperty ;
  rdfs:label "Тестовое булево свойство"@ru ;
  rdfs:label "Test boolean property"@en ;
  rdfs:domain v-ui:TestUIClass ;
  rdfs:range xsd:boolean ;
.
v-ui:testInteger
  rdf:type owl:DatatypeProperty ;
  rdfs:label "Тестовое целочисленное свойство"@ru ;
  rdfs:label "Test integer property"@en ;
  rdfs:domain v-ui:TestUIClass ;
  rdfs:range xsd:integer ;
.
v-ui:testDecimal
  rdf:type owl:DatatypeProperty ;
  rdfs:label "Тестовое десятичное свойство"@ru ;
  rdfs:label "Test decimal property"@en ;
  rdfs:domain v-ui:TestUIClass ;
  rdfs:range xsd:decimal ;
.
v-ui:testString
  rdf:type owl:DatatypeProperty ;
  rdfs:label "Тестовое текстовое свойство"@ru ;
  rdfs:label "Test string property"@en ;
  rdfs:domain v-ui:TestUIClass ;
  rdfs:range xsd:string ;
.
v-ui:testDatetime
  rdf:type owl:DatatypeProperty ;
  rdfs:label "Тестовое календарное свойство"@ru ;
  rdfs:label "Test datetime property"@en ;
  rdfs:domain v-ui:TestUIClass ;
  rdfs:range xsd:dateTime ;
.
v-ui:testLink
  rdf:type owl:ObjectProperty ;
  rdfs:label "Тестовое объектное свойство"@ru ;
  rdfs:label "Test object property"@en ;
  rdfs:domain v-ui:TestUIClass ;
  rdfs:range rdfs:Resource ;
.
v-ui:testFile
  rdf:type owl:ObjectProperty ;
  rdfs:label "Тестовое файловое свойство"@ru ;
  rdfs:label "Test file property"@en ;
  rdfs:domain v-ui:TestUIClass ;
  rdfs:range v-s:File ;
.
v-ui:SpecTestBoolean
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация тестового булева свойства"@ru ;
  rdfs:label "Specification for test boolean property"@en ;
  v-ui:forClass v-ui:TestUIClass ;
  v-ui:forProperty v-ui:testBoolean ;
.
v-ui:SpecTestInteger
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация тестового целочисленного свойства"@ru ;
  rdfs:label "Specification for test integer property"@en ;
  v-ui:forClass v-ui:TestUIClass ;
  v-ui:forProperty v-ui:testInteger ;
  v-ui:optionValue "1"^^xsd:integer ;
  v-ui:optionValue "2"^^xsd:integer ;
  v-ui:optionValue "3"^^xsd:integer ;
  v-ui:minCardinality "1"^^xsd:integer ;
  v-ui:maxCardinality "1"^^xsd:integer ;
.
v-ui:SpecTestDecimal
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация тестового десятичного свойства"@ru ;
  rdfs:label "Specification for test decimal property"@en ;
  v-ui:forClass v-ui:TestUIClass ;
  v-ui:forProperty v-ui:testDecimal ;
  v-ui:optionValue "1.1"^^xsd:string ;
  v-ui:optionValue "2.2"^^xsd:string ;
  v-ui:optionValue "3.3"^^xsd:string ;
.
v-ui:SpecTestString
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация тестового текстового свойства"@ru ;
  rdfs:label "Specification for test string property"@en ;
  v-ui:forClass v-ui:TestUIClass ;
  v-ui:forProperty v-ui:testString ;
  v-ui:optionValue "Предопределенное значение 1"^^xsd:string ;
  v-ui:optionValue "Предопределенное значение 2"^^xsd:string ;
  v-ui:optionValue "Предопределенное значение 3"^^xsd:string ;
  v-ui:minCardinality "1"^^xsd:integer ;
  v-ui:maxCardinality "1"^^xsd:integer ;
.
v-ui:SpecTestDatetime
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация тестового календарного свойства"@ru ;
  rdfs:label "Specification for test datetime property"@en ;
  v-ui:forClass v-ui:TestUIClass ;
  v-ui:forProperty v-ui:testDatetime ;
  v-ui:optionValue "2011-01-02"^^xsd:dateTime ;
  v-ui:optionValue "2012-03-04"^^xsd:dateTime ;
  v-ui:optionValue "2013-05-06"^^xsd:dateTime ;
  v-ui:defaultValue "2013-05-06"^^xsd:dateTime ;
.
v-ui:SpecTestLink
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация тестового объектного свойства"@ru ;
  rdfs:label "Specification for test link property"@en ;
  v-ui:forClass v-ui:TestUIClass ;
  v-ui:forProperty v-ui:testLink ;
  v-ui:minCardinality "1"^^xsd:integer ;
  v-ui:maxCardinality "1"^^xsd:integer ;
  v-ui:optionValue v-ui:SpecTestLink ;
  v-ui:optionValue v-ui:SpecTestDatetime ;
  v-ui:optionValue v-ui:SpecTestString ;
.

v-ui:TestUI
  rdf:type v-ui:TestUIClass ;
  rdfs:label "Индивид для тестирования интерфейса"@ru ;
  rdfs:label "Test UI individual"@en ;
  v-ui:testBoolean  "true"^^xsd:boolean ;
  v-ui:testString   "Тестовое значение строкового свойства"@ru ;
  v-ui:testString   "Test string property value"@en ;
  v-ui:testInteger  "999"^^xsd:integer ;
#  v-ui:testDatetime "1945-05-09T21:00:00"^^xsd:dateTime ;
#  v-ui:testLink     v-ui:TestUIClass ;
  v-ui:testDecimal  "3.1415926"^^xsd:decimal ;
.

v-ui:TestUITemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Тестовый шаблон"@ru ;
  rdfs:label "Test UI template"@en ;
  v-ui:forClass v-ui:TestUIClass ;
  v-ui:template """
<div class="container sheet">
  <div class="clearfix">
    <h2 class="pull-left" about="@" rel="rdf:type" data-template="v-ui:LabelTemplate"></h2>
    <a class="pull-right" href="#/@"><small property="@"></small></a>
  </div>

  <em about="rdfs:label" property="rdfs:label" class="-view edit search"></em>
  <h3 property="rdfs:label"></h3>
  <veda-control property="rdfs:label" data-type="string" class="-view edit search"></veda-control>
  <br class="-view edit search">
  <em about="rdfs:comment" property="rdfs:label" class="-view edit search"></em>
  <div><em property="rdfs:comment"></em></div>
  <veda-control property="rdfs:comment" data-type="string" class="-view edit search"></veda-control>
  <br class="-view edit search">

  <div class="checkbox">
    <label>
      <veda-control property="v-ui:testBoolean" data-type="boolean"></veda-control>
      <em about="v-ui:testBoolean" property="rdfs:label"></em>
    </label>
  </div>
  <hr>

  <em about="v-ui:testString" property="rdfs:label"></em>
  <div property="v-ui:testString"></div>
  <veda-control property="v-ui:testString" data-type="string" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testString" data-type="multilingualString" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testString" data-type="text" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testString" data-type="multilingualText" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testString" data-type="select" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testString" data-type="checkbox" class="view edit search"></veda-control>
  <veda-control property="v-ui:testString" data-type="radio" class="view edit search"></veda-control>
  <hr>

  <em about="v-ui:testInteger" property="rdfs:label"></em>
  <div property="v-ui:testInteger"></div>
  <veda-control property="v-ui:testInteger" data-type="integer" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testInteger" data-type="select" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testInteger" data-type="checkbox"></veda-control>
  <veda-control property="v-ui:testInteger" data-type="radio"></veda-control>
  <hr>

  <em about="v-ui:testDecimal" property="rdfs:label"></em>
  <div property="v-ui:testDecimal"></div>
  <veda-control property="v-ui:testDecimal" data-type="decimal" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testDecimal" data-type="select" class="-view edit search"></veda-control>
  <hr>

  <em about="v-ui:testDatetime" property="rdfs:label"></em>
  <div property="v-ui:testDatetime" class="view -edit -search"></div>
  <veda-control property="v-ui:testDatetime" data-type="dateTime" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testDatetime" data-type="select" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testDatetime" data-type="checkbox" class="-view edit search"></veda-control>
  <veda-control property="v-ui:testDatetime" data-type="radio" class="-view edit search"></veda-control>
  <hr>

  <em about="v-ui:testLink" property="rdfs:label"></em>
  <div rel="v-ui:testLink" data-template="v-ui:ClassNameLabelLinkTemplate"></div>
  <veda-control rel="v-ui:testLink" data-type="link" class="-view edit search full"></veda-control>
  <veda-control rel="v-ui:testLink" data-type="checkbox"></veda-control>
  <veda-control rel="v-ui:testLink" data-type="radio"></veda-control>
  <veda-control rel="v-ui:testLink" data-type="select" class="-view edit search"></veda-control>

  <!--hr>
  <em about="v-ui:template" property="rdfs:label"></em>
  <veda-control property="v-ui:template" data-type="source"></veda-control>
  <hr>
  <em about="v-s:script" property="rdfs:label"></em>
  <veda-control property="v-s:script" data-type="source"></veda-control-->

  <hr>
  <em about="v-ui:testFile" property="rdfs:label"></em>
  <div rel="v-ui:testFile" data-template="v-ui:FileTemplate" class="view edit -search"></div>
  <br>
  <veda-control rel="v-ui:testFile" data-type="file" class="-view edit -search"></veda-control>

  <div class="actions">
    <div about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete"></div>
  </div>
</div>
  """ ;
.
v-ui:PsCommentFile
  rdf:type v-ui:DatatypePropertySpecification ;
  v-ui:forClass v-s:File ;
  v-ui:forProperty rdfs:comment ;
  v-ui:minCardinality 0 ;
  v-ui:maxCardinality 1 ;
  v-ui:maxLength 100 ;
  v-ui:tooltip "Максимум 100 символов"@ru ;
  v-ui:tooltip "100 characters maximum"@en ;
.

v-ui:PSAttachmentThing
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация свойства v-s:attachment для класса v-s:Thing"@ru ;
  rdfs:label "Specification v-s:attachment for v-s:Thing class"@en ;
  v-ui:forClass v-s:Thing ;
  v-ui:forProperty v-s:attachment ;
  v-ui:minCardinality 0 ;
  v-ui:maxCardinality 100 ;
.

v-ui:FileTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для файла"@ru ;
  rdfs:label "File template"@en ;
  v-ui:template """
<div class="panel panel-default" style="word-wrap:break-word; display: inline-block; margin:5px 5px 0 0; overflow: hidden"">
  <div class="panel-body" style="padding:7px;">
    <span id="icon" class="label label-primary"></span>
    <a href="/files/@">
      <span about="@" property="v-s:fileName"></span>
    </a>
  </div>
</div>
<script>
  var fn = individual["v-s:fileName"][0],
    idx = fn.lastIndexOf("."),
    ext = fn.substr(idx + 1);
  $("span#icon", template).text(ext);
  //# sourceURL=v-ui:FileTemplate
</script>
  """ ;
.

v-ui:FileMinTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для файла"@ru ;
  rdfs:label "File template"@en ;
  v-ui:template """
<div>
  <a href="/files/@">
    <span about="@" property="v-s:fileName"></span>
  </a>
</div>
  """ ;
.

v-ui:FileTemplateWithComment
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для файла"@ru ;
  rdfs:label "File template"@en ;
  v-ui:forClass v-s:File ;
  v-ui:template """
<div class="horizontal-card">
  <div class="thumbnail" about="@" rel="v-s:thumbnail">
    <img src="/files/@">
  </div>
  <div class="description">
    <strong about="rdfs:comment" property="rdfs:label" class="-view edit search"></strong>
    <veda-control data-type="string" property="rdfs:comment" class="-view edit search margin-sm"></veda-control>
    <strong property="rdfs:comment" class="view -edit -search header"></strong>
    <hr class="margin-sm view -edit -search">
    <div class="file-name">
      <span class="icon label label-primary"></span>
      <a href="/files/@">
        <span about="@" property="v-s:fileName"></span>
      </a>
    </div>
    <i class="view -edit -search">
      <small rel="v-s:creator" data-template="v-ui:LabelTemplate"></small><small property="v-s:created"></small>
    </i>
  </div>
</div>
<script>
  var fn = individual["v-s:fileName"][0];
  if (typeof fn === "string" || fn instanceof String) {
    var idx = fn.lastIndexOf("."),
        ext = fn.substr(idx + 1);
    $("span.icon", template).text(ext);
  }
  //# sourceURL=v-ui:FileTemplateWithComment
</script>
  """ ;
.
v-ui:FileTemplateWithComment2
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для файла 2"@ru ;
  rdfs:label "File template 2"@en ;
  #v-ui:forClass v-s:File ;
  v-ui:template """
<div class="panel panel-default" style="word-wrap:break-word; width:250px; display: inline-block; margin:0 20px 20px 0; overflow: hidden">
  <div class="panel-body">
    <!--Remove-->
    <em about="v-s:fileUri" property="rdfs:label"></em>
    <veda-control data-type="string" property="v-s:fileUri"></veda-control>
    <em about="v-s:filePath" property="rdfs:label"></em>
    <veda-control data-type="string" property="v-s:filePath"></veda-control>
    <!--/Remove-->

    <em about="rdfs:comment" property="rdfs:label" class="-view edit search"></em>
    <strong property="rdfs:comment" class="view -edit -search"></strong>
    <veda-control data-type="string" property="rdfs:comment" class="-view edit search"></veda-control>
    <br>
    <hr class="margin-sm view -edit -search">
    <div>
      <span id="icon" class="label label-primary"></span>
      <a href="/files/@">
        <span about="@" property="v-s:fileName"></span>
      </a>
    </div>
    <div class="view -edit -search" style="font-style:italic">
      <small rel="v-s:creator" data-template="v-ui:LabelTemplate"></small><small property="v-s:created"></small>
    </div>
  </div>

  <!--Remove-->
  <div class="actions panel-footer">
    <div about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="save"></div>
  </div>
  <!--/Remove-->

</div>
<script>
  var fn = individual["v-s:fileName"][0];
  if (typeof fn === "string" || fn instanceof String) {
    var idx = fn.lastIndexOf("."),
        ext = fn.substr(idx + 1);
    $("span#icon", template).text(ext);
  }
  //# sourceURL=v-ui:FileTemplateWithComment
</script>
  """ ;
.
v-ui:ImageTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для изображения"@ru ;
  rdfs:label "Image template"@en ;
  v-ui:template """
<div>
  <a href="/files/@"><img class="img-thumbnail"></a>
</div>
<script>
   $("img", template).attr("src", "/files/" + individual.id);
  //# sourceURL=v-ui:ImageTemplate
</script>
  """ ;
.
v-ui:ModalImageTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для изображения"@ru ;
  rdfs:label "Image template"@en ;
  v-ui:template """
<div>
  <a id="link" href="#"><img class="img-thumbnail"></a>
  <div class="modal" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <img width="100%">
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  $("img", template).attr("src", "/files/" + individual.id);
  var modal;
  $("#link", template).click(function (e) {
    e.preventDefault();
    if (!modal) modal = $("#modal", template).modal();
    modal.modal("show");
  });
  //# sourceURL=v-ui:ModalImageTemplate
</script>
  """ ;
.
v-ui:ImageSimpleTemplateWithoutBorder
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для изображения"@ru ;
  rdfs:label "Image template"@en ;
  v-ui:template """
<img width="100%">
<script>
  template.attr("src", "/files/" + individual.id);
  //# sourceURL=v-ui:ImageSimpleTemplateWithoutBorder
</script>
  """ ;
.
v-ui:ImageSimpleTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для изображения без ссылки"@ru ;
  rdfs:label "Image template without link"@en ;
  v-ui:template """
<div>
  <img class="img-thumbnail">
</div>
<script>
  $("img", template).attr("src", "/files/" + individual.id);
  //# sourceURL=v-ui:ImageSimpleTemplate
</script>
  """ ;
.
v-ui:ImageSimpleTemplateTransparent
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для изображения без ссылки прозрачный фон"@ru ;
  rdfs:label "Image template without link transparent"@en ;
  v-ui:template """
<img width="100%">
<script>
  template.attr("src", "/files/" + individual.id);
  //# sourceURL=v-ui:ImageSimpleTemplateTransparent
</script>
  """ ;
.
v-ui:ImageTemplateTransparent
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для изображения со ссылкой прозрачный фон"@ru ;
  rdfs:label "Image template with link transparent"@en ;
  v-ui:template """
<div>
  <a href="/files/@"><img width="100%"></a>
</div>
<script>
  $("img", template).attr("src", "/files/" + individual.id);
  //# sourceURL=v-ui:ImageTemplateTransparent
</script>
  """ ;
.
v-ui:PsHasImage
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация изображения для класса Персона"@ru ;
  rdfs:label "Has image property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-s:hasImage ;
  v-ui:maxCardinality "1"^^xsd:integer ;
.
v-ui:SimplifiedJournalTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Упрощенный журнал"@ru ;
  rdfs:label "Simplified journal"@en ;
  v-ui:forClass v-s:Journal ;
  v-ui:template """
<script>
  var tbody = $("#tbody", template);
  var task_template = tbody.html();
  tbody.empty();
  var doc_uri = this.id.replace(/.$/, "");
  var doc = new veda.IndividualModel(doc_uri);
  $("#refresh", template).click(buildJournal);
  buildJournal();

  function buildJournal() {
    tbody.empty();
    var tasks = query({
      ticket: veda.ticket,
      query: "'rdf:type'=='v-wf:DecisionForm' && 'v-wf:onDocument'=='" + doc_uri + "'",
      sort: "'v-s:created' asc",
      async: true
    }).then(function (query_res) {
      var tasks_uris = query_res.result;
      return get_individuals({
        ticket: veda.ticket,
        uris: tasks_uris,
        async: true
      }).then(function (tasks) {
        tasks.forEach(function (task, index) {
          var task_individual = new veda.IndividualModel(task);
          task_individual.present(tbody, task_template).then(function (renderedTemplate) {
            $(".sequence-number", renderedTemplate).text(index + 1);
          });
        });
      });
    });
  };

  $("#on-document", template).attr("about", doc_uri);

  $('.createReport0', template).on('click', function () {
    veda.Util.createReport(doc,'v-s:Journal_printBlank');
  });
  $('#createReport',template).on('click', function (e) {
    e.preventDefault();
    veda.Util.createReport(doc, 'v-s:JournalCoordination_printBlank_pdf');
  });
  $('#createReport2', template).on('click', function (e) {
    e.preventDefault();
    veda.Util.createReport(doc, 'v-s:JournalCoordination_printBlank_xlsx');
  });
  $('#createReport3', template).on('click', function (e) {
    e.preventDefault();
    veda.Util.createReport(doc, 'v-s:JournalCoordination_printBlank_docx');
  });
  //# sourceURL=v-ui:SimplifiedJournalTemplate_pre
</script>
<div class="container sheet">
  <div class="row">
    <div class="col-md-6">
      <h2 about="v-s:Journal" property="rdfs:label"></h2>
    </div>
    <div class="col-md-6 text-right">
      <a href="#/@//v-ui:JournalTemplate" class="btn btn-link"><span about="v-ui:JournalTemplate" property="rdfs:label"></span></a>
      <button type="button" class="action btn btn-info view -edit -search createReport0" about="v-s:PrintBlank" property="rdfs:label"></button>
      <div class="btn-group dropdown">
        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span about="v-s:CoordinationList" property="rdfs:label"> </span>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li><a href="#v-s:JournalCoordination_printBlank_pdf" id="createReport" about="v-s:JournalCoordination_printBlank_pdf" property="rdfs:label"></a></li>
          <li><a href="#v-s:JournalCoordination_printBlank_xlsx" id="createReport2" about="v-s:JournalCoordination_printBlank_xlsx" property="rdfs:label"></a></li>
          <li><a href="#v-s:JournalCoordination_printBlank_docx" id="createReport3" about="v-s:JournalCoordination_printBlank_docx" property="rdfs:label"></a></li>
        </ul>
      </div>
    </div>
  </div>
  <h4 id="on-document" data-template="v-ui:ClassNameLabelLinkTemplate"></h4>
  <div id="tasks" class="table-responsive">
    <table class="table">
      <thead>
        <tr class="active">
          <th width="1%">#</th>
          <th width="15%" about="v-wf:from" property="rdfs:label"></th>
          <th width="15%" about="v-wf:to" property="rdfs:label"></th>
          <th width="25%" about="v-s:description" property="rdfs:label"></th>
          <th width="15%"><span about="v-s:created" property="rdfs:label"></span> <span>&uarr;</span></th>
          <th about="v-wf:takenDecision" property="rdfs:label"></th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr>
          <td class="sequence-number"></td>
          <td property="v-wf:from"></td>
          <td property="v-wf:to"></td>
          <td><a href="#/@" property="rdfs:label"></a><div property="v-s:description"></div></td>
          <td property="v-s:created"></td>
          <td rel="v-wf:takenDecision">
            <div>
              <div rel="v-s:creator" data-template="v-ui:LabelTemplate"></div>
              <strong property="rdfs:label"></strong><i property="rdfs:comment"></i>
              <div property="v-s:created"></div>
            </div>
          </td>
        </tr>
        <script>
          if ( this.hasValue("v-wf:isCompleted", true) ) {
            template.children().first().addClass("success");
          }
        </script>
      </tbody>
    </table>
    <button class="btn btn-default" id="refresh" about="v-s:RefreshBundle" property="rdfs:label"></button>
  </div>
</div>
  """ ;
.
v-ui:JournalTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Детальный журнал"@ru ;
  rdfs:label "Detailed journal"@en ;
  v-ui:forClass v-s:Journal ;
  v-ui:template """
<script>
  //individual.prefetch(50, "v-s:onDocument", "v-wf:onProcess", "v-s:childRecord", "v-s:processJournal", "v-s:subJournal", "v-wf:takenDecision", "v-s:actor", "v-s:creator", "v-wf:executor");

  var doc_uri = this.id.replace(/.$/, "");
  var doc = new veda.IndividualModel(doc_uri);

  $("#on-document", template).attr("about", doc_uri);

  $('.createReport0', template).on('click', function () {
    veda.Util.createReport(doc,'v-s:Journal_printBlank');
  });
  $('#createReport',template).on('click', function (e) {
    e.preventDefault();
    veda.Util.createReport(doc, 'v-s:JournalCoordination_printBlank_pdf');
  });
  $('#createReport2', template).on('click', function (e) {
    e.preventDefault();
    veda.Util.createReport(doc, 'v-s:JournalCoordination_printBlank_xlsx');
  });
  $('#createReport3', template).on('click', function (e) {
    e.preventDefault();
    veda.Util.createReport(doc, 'v-s:JournalCoordination_printBlank_docx');
  });
  //# sourceURL=v-ui:JournalTemplate_pre
</script>
<div class="container journal sheet">
  <style>
    .journal-record > div > .sub-journal {margin-left: 5px; padding-left: 20px; border-left: 1px solid #ddd;}
    .journal hr.margin-sm {margin: 10px 0px;}
  </style>
  <div class="row">
    <div class="col-md-6">
      <h2 about="v-s:Journal" property="rdfs:label"></h2>
    </div>
    <div class="col-md-6 text-right">
      <a href="#/@//v-ui:SimplifiedJournalTemplate" class="btn btn-link"><span about="v-ui:SimplifiedJournalTemplate" property="rdfs:label"></span></a>
      <button type="button" class="action btn btn-info view -edit -search createReport0" about="v-s:PrintBlank" property="rdfs:label"></button>
      <div class="btn-group dropdown">
        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span about="v-s:CoordinationList" property="rdfs:label"> </span>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li><a href="#v-s:JournalCoordination_printBlank_pdf" id="createReport" about="v-s:JournalCoordination_printBlank_pdf" property="rdfs:label"></a></li>
          <li><a href="#v-s:JournalCoordination_printBlank_xlsx" id="createReport2" about="v-s:JournalCoordination_printBlank_xlsx" property="rdfs:label"></a></li>
          <li><a href="#v-s:JournalCoordination_printBlank_docx" id="createReport3" about="v-s:JournalCoordination_printBlank_docx" property="rdfs:label"></a></li>
        </ul>
      </div>
    </div>
  </div>
  <h4 id="on-document" data-template="v-ui:ClassNameLabelLinkTemplate"></h4>
  <div rel="v-wf:onProcess">
    <div>
      <h4>
        <span about="rdf:type" property="rdfs:label"></span>:
        <span about="@" data-template="v-ui:ClassNameLabelLinkTemplate"></span>
      </h4>
    </div>
  </div>
  <div class="well well-sm">
    <div class="row">
      <div class="col-md-3 col-sm-3">
        <strong about="v-s:JournalRecord" property="rdfs:label"></strong>
      </div>
      <div class="col-md-7 col-sm-6">
        <strong about="v-s:description" property="rdfs:label"></strong>
      </div>
      <div class="col-md-2 col-sm-3 text-right">
        <strong about="v-s:created" property="rdfs:label"></strong>
      </div>
    </div>
  </div>
  <div id="records">
    <div rel="v-s:childRecord"></div>
  </div>
</div>
  """ ;
.
v-ui:SubJournalTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон поджурнала"@ru ;
  rdfs:label "Subjournal template"@en ;
  v-ui:template """
<div class="sub-journal">
  <div rel="v-s:childRecord"></div>
</div>
  """ ;
.
v-ui:DocumentEventTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон события документа"@ru ;
  rdfs:label "Document event template"@en ;
  v-ui:forClass v-s:DocumentCreated, v-s:DocumentUpdated, v-s:DocumentDeleted, v-s:ProcessStarted, v-wf:ProcessStopped ;
  v-ui:template """
<script>
  if (!individual.hasValue("v-wf:initiator")) $("#initiator", template).remove();
  if (individual.hasValue("v-s:actor", "cfg:VedaSystem")) {
    //template.hide();
    template.empty();
  }
  $("#exp", template).click(function (e) {
    e.preventDefault();
    $("div[rel='v-s:processJournal']", template).toggle();
    $(this).children(":first").toggleClass("glyphicon-chevron-down glyphicon-chevron-right");
  });
  if (individual.hasValue("rdf:type", "v-s:ProcessStarted")) {
    $(".start-process", template).show();
    $(".non-start-process", template).hide();
    var process = individual['v-wf:onProcess'][0];
    if (
      (!process.hasValue("v-wf:isStopped") || process.hasValue("v-wf:isStopped", false))
      && (!process.hasValue("v-wf:isCompleted") || process.hasValue("v-wf:isCompleted", false))
      && process.rights.hasValue("v-s:canDelete")
    ) {
      $(".stop-process", template).show();
    }
    if (process.hasValue("v-wf:isStopped", true)) {
      $(".start-process", template).addClass('text-danger');
      $(".start-process > .glyphicon-minus-sign", template).show();
    }
  }
  if (individual.hasValue("rdf:type", "v-wf:ProcessStopped")) {
    $(".row", template).addClass('text-danger');
  }
  //# sourceURL=v-ui:DocumentEventTemplate_pre
</script>
<div class="journal-record">
  <hr class="margin-sm">
  <div class="row">
    <div class="col-md-3 col-sm-3 event-type">
      <span class="start-process" href="#" style="display:none">
        <a href="#" id="exp"><span class="glyphicon glyphicon-chevron-down"></span></a>
        <strong rel="rdf:type" data-template="v-ui:LabelTemplate"></strong>
        <span class="glyphicon glyphicon-minus-sign" style="display:none;"></span>
      </span>
      <span class="non-start-process" rel="rdf:type" data-template="v-ui:LabelTemplate"></span>
    </div>
    <div class="col-md-3 col-sm-6 event-desc">
      <div property="rdfs:label"></div>
      <span class="actor">
        <span about="v-s:actor" property="rdfs:label"></span>:
        <strong rel="v-s:actor" data-template="v-ui:LabelTemplate"></strong>
      </span>
    </div>
    <div class="col-md-4 col-sm-6 event-desc">
      <div property="rdfs:label"></div>
      <div rel="v-s:documentVersion" data-template="v-ui:LabelLinkTemplate"></div>
      <div rel="v-wf:onProcess">
        <script>
          var startFormVar = this["v-wf:inVars"].filter(function (vrbl) {
            return vrbl.hasValue("v-wf:variableName",  "startForm_id");
          });
          if (startFormVar.length) {
            $("[about='start-form']", template).attr("about", startFormVar[0]["v-wf:variableValue"][0].id);
          } else {
            $("[about='start-form']", template).remove();
          }
        </script>
        <div>
          <a href="#/@" rel="v-wf:instanceOf" data-template="v-ui:LabelTemplate"></a>
          <button class="btn btn-xs btn-default btn-danger stop-process glyphicon glyphicon-remove" style="display:none"></button>
          <div about="start-form">
            <div>
              <strong about="v-wf:StartForm" property="rdfs:label"></strong>: <a href="#/@" about="@" rel="rdf:type" data-template="v-ui:LabelTemplate"></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-2 col-sm-3 event-date text-right">
      <span property="v-s:created"></span>
    </div>
  </div>
  <div rel="v-s:processJournal" data-template="v-ui:SubJournalTemplate"></div>
</div>
<script>
  if (individual.hasValue("rdf:type") && individual["rdf:type"][0].id === 'v-s:ProcessStarted') {
    var process = individual['v-wf:onProcess'][0];
    if ((!process.hasValue("v-wf:isStopped") || process["v-wf:isStopped"][0] === false) &&
        (!process.hasValue("v-wf:isCompleted") || process["v-wf:isCompleted"][0] === false)) {
      $(".stop-process", template).on("click", function() {
        var warn = new veda.IndividualModel("v-s:AreYouSure")["rdfs:label"].join(" ");
        if ( confirm(warn) ) {
          process['v-wf:isStopped'] = [ true ];
          process.save();
          $(this).remove();
        }
      });
    }
    if (process.hasValue("v-wf:isStopped", true)) {
      $(".start-process > #exp", template).trigger("click");
    }
  }
  //# sourceURL=v-ui:DocumentEventTemplate_post
</script>
  """ ;
.

v-ui:PermissionStatementInlineTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса записи выдачи прав"@ru ;
  rdfs:label "Document event template"@en ;
  v-ui:forClass v-s:PermissionStatement ;
  v-ui:template """
  <div>
  <div class="row right-header" style="display:none">
    <div class="col-md-1">
      <span about="v-s:canCreate" property="rdfs:label"></span>
    </div>
    <div class="col-md-1">
      <span about="v-s:canRead" property="rdfs:label"></span>
    </div>
    <div class="col-md-1">
      <span about="v-s:canUpdate" property="rdfs:label"></span>
    </div>
    <div class="col-md-1">
      <span about="v-s:canDelete" property="rdfs:label"></span>
    </div>
    <div class="col-md-3">
      <span about="v-s:permissionObject" property="rdfs:label"></span>
    </div>
    <div class="col-md-3">
      <span about="v-s:permissionSubject" property="rdfs:label"></span>
    </div>
    <div class="col-md-1">
      <span about="v-s:startTime" property="rdfs:label"></span>
    </div>
    <div class="col-md-1">
      <span about="v-s:endTime" property="rdfs:label"></span>
    </div>
    <div class="col-md-12">
      <span about="rdfs:comment" property="rdfs:label"></span>
    </div>
  </div>
  <hr/>
  <div class="row">
    <div class="col-md-1">
      <span about="@" property="v-s:canCreate"></span>
    </div>
    <div class="col-md-1">
      <span about="@" property="v-s:canRead"></span>
    </div>
    <div class="col-md-1">
      <span about="@" property="v-s:canUpdate"></span>
    </div>
    <div class="col-md-1">
      <span about="@" property="v-s:canDelete"></span>
    </div>
    <div class="col-md-3">
      <span rel="v-s:permissionObject" data-template="v-ui:LabelLinkTemplate"></span>
    </div>
    <div class="col-md-3">
      <span rel="v-s:permissionSubject" data-template="v-ui:LabelLinkTemplate"></span>
    </div>
    <div class="col-md-1">
      <span about="@" property="v-s:startTime"></span>
    </div>
    <div class="col-md-1">
      <span about="@" property="v-s:endTime"></span>
    </div>
    <div class="col-md-12">
      <pre style="border:none;background-color:#fff;"></pre>
    </div>
  </div>
  </div>
  <script>
//    if (!individual.hasValue("v-s:permissionObject") && !individual.hasValue("v-s:permissionSubject")) $(".right-header", template).show();
    var dd = individual['rdfs:comment'][0];
    var pre = $("pre", template);
    var anchored = dd.replace(/([a-z0-9_-]+:[a-z0-9_-]*)/gi, "<a class='text-black' href='#/$1//v-ui:ttl'>$1</a>");
    pre.html(anchored);
    //# sourceURL=v-ui:PermissionStatementInlineTemplate_post
  </script>
  """ ;
.

v-ui:TreeTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для древовоидных структур"@ru ;
  rdfs:label "Template for tree-like structures"@en ;
  v-ui:template """
<div class="table-responsive">
  <table class="table table-condensed table-striped">
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
  </table>
</div>
<script>
  var tbody = $("#tbody", template);
  var thead = $("#thead", template);

  var rel_uri = individual.treeConfig.targetRel_uri;
  var headTmpl = "";
  var rowTmpl = "";

  if (rel_uri) {
    headTmpl += "<th width='1px'><input type='checkbox' id='select-col' /></th>";
    rowTmpl += "<td><input type='checkbox' class='select-row' /></td>";
  }

  var literals = ["rdfs:Literal", "xsd:string", "xsd:boolean", "xsd:integer", "xsd:nonNegativeInteger", "xsd:decimal", "xsd:dateTime"];
  var allowedClassIds = individual.treeConfig.allowedClass ? individual.treeConfig.allowedClass.map(function (_class) {
    return _class.id;
  }) : [];
  var selectableClassIds = individual.treeConfig.selectableClass ? individual.treeConfig.selectableClass.map(function (_class) {
    return _class.id;
  }) : [];
  var selectableFilter = individual.treeConfig.selectableFilter ? new Function( individual.treeConfig.selectableFilter[0].toString() ) : undefined;

  individual.treeConfig.displayedProperty.map( function (property, index) {
    headTmpl += "<th>" + property["rdfs:label"].join(", ") + "</th>";
    var isLiteral = (literals.indexOf(property["rdfs:range"][0].id) >= 0);
    if ( index === 0 ) {
      if (isLiteral) {
        rowTmpl += "<td><div class='spacer'></div><a href='#' class='expand glyphicon glyphicon-chevron-right'></a> <span about='@' property='" + property.id + "'></span></td>";
      } else {
        rowTmpl += "<td><div class='spacer'></div><a href='#' class='expand glyphicon glyphicon-chevron-right'></a> <span about='@' rel='" + property.id + "' data-template='v-ui:LabelTemplate'></span></td>";
      }
      return;
    } else {
      if ( isLiteral ) {
        rowTmpl += "<td about='@' property='" + property.id + "'></td>";
      } else {
        rowTmpl += "<td about='@' rel='" + property.id + "' data-template='v-ui:LabelTemplate'></td>";
      }
    }
  });
  headTmpl = "<tr>" + headTmpl + "</tr>";
  thead.html(headTmpl);
  individual.treeConfig.rowTmpl = rowTmpl;

  template.on("click", "a.expand", function (e) {
    e.stopPropagation();
    e.preventDefault();
    var that = $(this),
      thatRow = that.parents("tr"),
      thatLvl = parseInt( thatRow.attr("data-level") ),
      uri = thatRow.attr("resource"),
      self = new veda.IndividualModel(uri);

    that.toggleClass("expanded glyphicon-chevron-right glyphicon-chevron-down");

    if ( that.hasClass("expanded") ) {
      var nextLvl = parseInt( thatRow.next().attr("data-level") );
      if ( nextLvl > thatLvl ) {
        thatRow.nextUntil("[data-level=" + thatLvl + "]").show();
      } else {
        getOut(self).map(render);
        getIn(self).map(render);
        var newNextLvl = parseInt(thatRow.next().attr("data-level"));
        if ( isNaN(newNextLvl) || newNextLvl <= thatLvl ) {
          that.prev().css("width", 16 * (thatLvl + 1) - 2);
          that.remove();
        }
      }
    } else {
      thatRow.nextAll().each( function () {
        var that = $(this),
          lvl = parseInt( that.attr("data-level") );
        if ( isNaN(lvl) || lvl <= thatLvl) return false;
        that.hide();
      });
    }

    function render(item) {
      var cont = $("<div>"),
          tmpl = $("<tr>").attr("data-level", thatLvl + 1).append(rowTmpl);
      $(".spacer", tmpl).css({"width": 16 * (thatLvl + 1) + "px", "display": "inline-block"});
      tmpl = item.present(cont, tmpl[0].outerHTML);

      var hasValue = individual.hasValue(rel_uri, item);
      $("input", tmpl).prop("checked", hasValue);

      if (selectableFilter) {
        if ( !selectableFilter.call(item) ) {
          $("input", tmpl).remove();
        }
      } else if (selectableClassIds.length && selectableClassIds.indexOf(item["rdf:type"][0].id) < 0) {
        $("input", tmpl).remove();
      }
      thatRow.after( tmpl );
    }
    return false;
  });

  if (rel_uri) {

    template.on("click", "th > input", function (e) {
      if ( $(this).is(":checked") ) {
        var values = [];
        $("table input", template).each(function () {
          $(this).prop("checked", true);
          var row = $(this).parent().parent(),
              uri = row.attr("resource"),
              value = new veda.IndividualModel(uri);
          values.push(value);
        });
        individual[rel_uri] = values;
      } else {
        $("table input", template).prop("checked", false);
        individual[rel_uri] = [];
      }
    });

    template.on("click", "td", function (e) {
      e.stopPropagation();
      var row = $(this).parent();
      $("input", row).click();
    });

    template.on("click", "td > input", function (e) {
      e.stopPropagation();
      var row = $(this).parent().parent(),
          uri = row.attr("resource"),
          value = new veda.IndividualModel(uri);
      var filtered = individual[rel_uri].filter(function (item) {
        return item.id !== value.id;
      });
      if ( $(this).prop("checked") ) {
        individual[rel_uri] = filtered.concat(value);
      } else {
        individual[rel_uri] = filtered;
      }
    });

  }

  // Render tree
  individual.treeConfig.root.map( function (root, index, all) {
    var tmpl = $("<tr>").attr("data-level", 0).append(rowTmpl);
    tmpl = root.present(tbody, tmpl[0].outerHTML);

    if (all.length === 1) {
      $(".expand", tmpl).click();
    }

    var hasValue = individual.hasValue(rel_uri, root);
    $("input", tmpl).prop("checked", hasValue);

    if (selectableFilter) {
      if ( !selectableFilter.call(root) ) {
        $("input", tmpl).remove();
      }
    } else if (selectableClassIds.length && selectableClassIds.indexOf(root["rdf:type"][0].id) < 0) {
      $("input", tmpl).remove();
    }
  });

  function getOut(self) {
    var res = [];
    if (individual.treeConfig && individual.treeConfig.outProperty) {
      individual.treeConfig.outProperty.map(function (property) {
        if (self.hasValue(property.id)) {
          self[property.id].map(function (value) {
            if ( !allowedClassIds.length || allowedClassIds.indexOf(value["rdf:type"][0].id) > -1 ) {
              res.push(value);
            }
          });
        }
      });
    }
    return res;
  }

  function getIn(self) {
    var res = [];
    if (individual.treeConfig && individual.treeConfig.inProperty) {
      var q = individual.treeConfig.inProperty.map(function (property) {
          return "'" + property.id + "'=='" + self.id + "'";
        }).join(" || ");
      if (individual.treeConfig.allowedClass) {
        q = "(" + q + ") && (" + individual.treeConfig.allowedClass.map(function (_class) {
          return "'rdf:type'==='" + _class.id + "'";
        }).join(" || ") + ")";
      }
      var sort = individual.treeConfig.sort ? individual.treeConfig.sort : "'rdfs:label' desc";
      var result = query(veda.ticket, q, sort).result;
      result.map( function (uri) {
        res.push( new veda.IndividualModel(uri) );
      });
    }
    return res;
  }
  //# sourceURL=v-ui:TreeTemplate
</script>
  """ ;
.

td:PersonTemplate1
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон персоны"@ru ;
  rdfs:label "Person template"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:template """
<div>
  <div class="container sheet">
    <div class="text-right">
      <a href="#/@"><span property="@">ID</span></a>
      <a href="#/@//v-ui:Graph"><span class="glyphicon glyphicon-link"></span></a>
    </div>
    <div class="row">
      <div class="col-md-2">
        <div rel="v-s:hasImage" data-template="v-ui:ImageTemplate"></div>
        <veda-control data-type="file" rel="v-s:hasImage" class="-view edit -search"></veda-control>
      </div>
      <div class="col-md-10">
        <h3>
          <span property="rdfs:label"></span>
          <veda-control property="rdfs:label" data-type="string" class="-view edit search"></veda-control>
        </h3>
        <div class="row">
          <div class="col-md-3">
            <em about="v-s:lastName" property="rdfs:label">Фамилия</em>
            <div property="v-s:lastName"></div>
            <veda-control property="v-s:lastName" data-type="string" class="-view edit search"></veda-control>
          </div>
          <div class="col-md-3">
            <em about="v-s:firstName" property="rdfs:label">Имя</em>
            <div property="v-s:firstName"></div>
            <veda-control property="v-s:firstName" data-type="string" class="-view edit search"></veda-control>
          </div>
          <div class="col-md-3">
            <em about="v-s:middleName" property="rdfs:label">Отчество</em>
            <div property="v-s:middleName"></div>
            <veda-control property="v-s:middleName" data-type="string" class="-view edit search"></veda-control>
          </div>
            <div class="col-md-3">
            <em about="v-s:birthday" property="rdfs:label">День рождения</em>
            <div property="v-s:birthday"></div>
            <veda-control property="v-s:birthday" data-type="dateTime" class="-view edit search"></veda-control>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <div class="row">
      <div class="col-md-6">
        <div about="@" rel="v-s:hasAccount" data-template="td:AccountTemplate1" data-embedded="true"></div>
        <veda-control rel="v-s:hasAccount" data-type="link" class="-view edit search fulltext dropdown create"></veda-control>
      </div>
      <div class="col-md-6">
        <div about="@" rel="v-ui:hasPreferences" data-template="td:PreferencesTemplate1" data-embedded="true"></div>
        <veda-control rel="v-ui:hasPreferences" data-type="link" class="-view edit search fulltext dropdown create"></veda-control>
        <br>
        <div about="@" rel="v-s:hasAppointment" data-template="td:AppointmentTemplate1" data-embedded="true"></div>
        <veda-control rel="v-s:hasAppointment" data-type="link" class="-view edit search fulltext dropdown create"></veda-control>
      </div>
    </div>
    <br>
    <div about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete"></div>
  </div>
  <br>
  <div about="@" class="container sheet view edit -search" data-template="v-s:LinksTemplate" data-embedded="true"></div>
  <br>
  <div about="@" class="container sheet view -edit -search" data-template="v-s:CommentsTemplate"></div>
</div>
""" ;
.
td:PsHasAppointmentPerson
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация назначения для класса Персона"@ru ;
  rdfs:label "Appointment property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-s:hasAppointment ;
  v-ui:queryPrefix "('rdf:type'=='v-s:Appointment')"^^xsd:string ;
.
td:AppointmentTemplate1
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон Назначения"@ru ;
  rdfs:label "Appointment template"@en ;
  v-ui:template """
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-6">
        <span about="v-s:Appointment" property="rdfs:label">Имя класса</span>
        </div>
        <div class="col-md-6 text-right">
          <a href="#/@"><span property="@">ID</span></a>
      </div>
    </div>
    </div>
    <div class="panel-body">
      <h3 property="rdfs:label"></h3>
      <veda-control property="rdfs:label" data-type="string" class="-view edit search"></veda-control>
      <div class="row">
        <div class="col-md-6">
          <em about="v-s:employee" property="rdfs:label"></em>
          <div rel="v-s:employee" data-template="v-ui:LabelTemplate" class="view -edit search"></div>
          <veda-control rel="v-s:employee" data-type="link" class="-view edit search fulltext full"></veda-control>
        </div>
        <div class="col-md-6">
          <em about="v-s:occupation" property="rdfs:label"></em>
          <div rel="v-s:occupation" data-template="v-ui:LabelTemplate" class="view -edit search"></div>
          <veda-control rel="v-s:occupation" data-type="link" class="-view edit search fulltext"></veda-control>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <em about="v-s:parentUnit" property="rdfs:label"></em>
          <div rel="v-s:parentUnit" data-template="v-ui:LabelTemplate" class="view -edit search"></div>
          <veda-control rel="v-s:parentUnit" data-type="link" class="-view edit search fulltext"></veda-control>
        </div>
      </div>
    </div>
    <!--div class="actions panel-footer">
      <div about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete"></div>
    </div-->
  </div>
  """ ;
.

td:AppointmentTemplate2
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон Назначения 2"@ru ;
  rdfs:label "Appointment template 2"@en ;
  v-ui:template """
  <div>
    <span rel="v-s:employee" data-template="v-ui:LabelTemplate">Работник</span>,
    <span rel="v-s:occupation" data-template="v-ui:LabelTemplate">Должность</span>
  </div>
  """ ;
.

v-ui:ttl
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон TTL"@ru ;
  rdfs:label "Template TTL"@en ;
  v-ui:template """
<div class="container sheet">
  <pre style="border:none;background-color:#fff;"></pre>
  <div class="actions pull-left">
    <div about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="delete destroy"></div>
  </div>
  <div class="pull-right">
    <a id="default" class="btn btn-info" href="#/@" about="v-s:Default" property="rdfs:label"></a>
    <a id="generic" class="btn btn-default" href="#/@//v-ui:generic">generic</a>
    <a id="json" class="btn btn-default" href="#/@//v-ui:json">json</a>
    <a id="ttl" class="disabled btn btn-default" href="#/@//v-ui:ttl">ttl</a>
  </div>
</div>
<script>
  var list = [individual];
  veda.Util.toTTL(list, function (error, ttl) {
    var pre = $("pre", template),
        anchored = ttl.replace(/([a-z0-9_-]+:[a-z0-9_-]*)/gi, "<a class='text-black' href='#/$1//v-ui:ttl'>$1</a>");
    pre.html(anchored);
  });
  //# sourceURL=v-ui:ttl
</script>
  """ ;
.

v-ui:json
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон JSON"@ru ;
  rdfs:label "Template JSON"@en ;
  v-ui:template """
<div class="container sheet">
  <pre class="view -edit -search" style="border:none;background-color:#fff;"></pre>
  <textarea class="form-control -view edit search" style='font-family:Menlo,Monaco,Consolas,"Courier New",monospace;font-size:13px;color:black;'></textarea>
  <br>
  <div class="pull-right">
    <a id="default" class="btn btn-info" href="#/@" about="v-s:Default" property="rdfs:label"></a>
    <a id="generic" class="btn btn-default" href="#/@//v-ui:generic">generic</a>
    <a id="json" class="disabled btn btn-default" href="#/@//v-ui:json">json</a>
    <a id="ttl" class="btn btn-default" href="#/@//v-ui:ttl">ttl</a>
  </div>
  <div class="actions pull-left">
    <div about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete destroy"></div>
  </div>
</div>
<script>
  var pre = $("pre", template),
      textarea = $("textarea", template),
      json = individual.properties;
  var formatted = format(json);
  var anchorized = anchorize(formatted);
  var height = $("#copyright").offset().top - container.offset().top - 120;
  pre.css("height", height);
  pre.html(anchorized);
  textarea.val(formatted);
  textarea.css("min-height", height);
  template.on("cancel", function () {
    pre.html(anchorized);
    textarea.text(formatted);
  });
  template.on("save", function () {
    var notify = veda.Notify ? new veda.Notify() : function () {};
    var original = individual.properties;
    try {
      formatted = textarea.val();
      anchorized = anchorize(formatted);
      pre.html(anchorized);
      json = JSON.parse(formatted);
      individual.properties = json;
      individual.isSync(false);
      individual.save();
      notify("success", {name: "Объект сохранен"});
    } catch (error) {
      individual.properties = original;
      notify("danger", error);
    }
  });
  function format (json) {
    var ordered = {};
    Object.keys(json).sort().forEach(function(key) {
      ordered[key] = json[key];
    });
    return JSON.stringify(ordered, null, 2);
  };
  function anchorize (string) {
    return string.replace(/([a-z0-9_-]+:[a-z0-9_-]*)/gi, "<a class='text-black' href='#/$1//v-ui:json'>$1</a>");
  };
  //# sourceURL=v-ui:json
</script>
  """ ;
.

v-ui:generic
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон общий"@ru ;
  rdfs:label "Template generic"@en ;
  v-ui:template """
<script>
  // Construct generic template
  var props = $("#properties", template);
  var propTmpl = props.html();
  props.empty();

  var ontology = new veda.OntologyModel();

  var properties = [].concat.apply(
    [],
    individual["rdf:type"].map( function (_class) {
      $(".className", template).append (
        $("<span/>", {"about": _class.id, "property": "rdfs:label"})
      );
      return ontology.getClassProperties(_class.id);
    })
  );

  props.append (
    properties.map( function (property_uri, index, array) {

      if (property_uri === "@" || property_uri === "rdfs:label" || property_uri === "rdf:type" || property_uri === "v-s:deleted") { return; }

      var property = new veda.IndividualModel(property_uri);

      var result = $("<div/>").append( propTmpl );
      $(".name", result).append (
          $("<strong/>", {"about": property_uri, "property": "rdfs:label"}).addClass("text-muted")
      );

      var range = property.hasValue("rdfs:range") ? property["rdfs:range"][0].id : "rdfs:Resource";

      switch ( range ) {
        case "rdfs:Literal":
        case "xsd:string":
          if (property_uri === "v-s:script" || property_uri === "v-ui:template") {
            $(".value", result).append (
                "<veda-control property='" + property_uri + "' data-type='source'></veda-control>"
            );
          } else {
            $(".value", result).append (
                "<div property='" + property_uri + "' class='view -edit -search'/>" +
                "<veda-control property='" + property_uri + "' data-type='multilingualText' class='-view edit search'></veda-control>"
            );
          }
          break;
        case "xsd:integer":
        case "xsd:nonNegativeInteger":
          $(".value", result).append (
              "<div property='" + property_uri + "' />" +
              "<veda-control property='" + property_uri + "' data-type='integer' class='-view edit search'></veda-control>"
          );
          break;
        case "xsd:decimal":
          $(".value", result).append (
              "<div property='" + property_uri + "' />" +
              "<veda-control property='" + property_uri + "' data-type='decimal' class='-view edit search'></veda-control>"
          );
          break;
        case "xsd:dateTime":
          $(".value", result).append (
              "<div property='" + property_uri + "' />" +
              "<veda-control property='" + property_uri + "' data-type='dateTime' class='-view edit search'></veda-control>"
          );
          break;
        case "xsd:boolean":
          $(".name", result).empty();
          $(".value", result).append (
              "<div class='checkbox'>" +
              "<label>" +
              "<veda-control property='" + property_uri + "' data-type='boolean'></veda-control>" +
              "<em about='" + property_uri + "' property='rdfs:label' class='text-muted'></em>" +
              "</label>" +
              "</div>"
          );
          break;
        case "rdfs:Resource":
          $(".value", result).append (
              "<div property='" + property_uri + "' />" +
              "<veda-control property='" + property_uri + "' data-type='generic' class='-view edit search'></veda-control>"
          );
          break;
        default:
          if (property_uri === "v-s:attachment") {
            $(".value", result).append (
                "<div rel='" + property_uri + "' data-template='v-ui:FileTemplateWithComment' data-embedded='true' />" +
                "<veda-control rel='" + property_uri + "' data-type='file' class='-view edit -search'></veda-control>"
            );
          } else {
            $(".value", result).append (
                "<div rel='" + property_uri + "' data-template='v-ui:ClassNameLabelLinkTemplate' />" +
                "<veda-control rel='" + property_uri + "' data-type='link' class='-view edit search fulltext dropdown'></veda-control>"
            );
          }
          break;
      }
      if (index < array.length-1) result.append( $("<hr/>").attr("style", "margin: 10px 0px") );

      return result;
    })
  );
  //# sourceURL=v-ui:generic
</script>
<div class="container sheet">
  <div class="row">
    <div class="col-md-4 col-xs-5 text-right">
      <h2 class="text-muted className"></h2>
    </div>
    <div class="col-md-8 col-xs-7">
      <h2 about="@" property="rdfs:label"></h2>
    </div>
  </div>
  <hr style="margin: 10px 0px"/>
  <div class="row">
    <div class="col-md-4 col-xs-5 text-right">
      <strong class="text-muted">@</strong>
    </div>
    <div class="col-md-8 col-xs-7">
      <a href="#/@"><span property="@"></span></a>
      <a href="#/@//v-ui:Graph"><span class="glyphicon glyphicon-link"></span></a>
    </div>
  </div>
  <hr style="margin: 10px 0px"/>
  <div class="row">
    <div class="col-md-4 col-xs-5 text-right">
      <strong about="rdf:type" property="rdfs:label" class="text-muted"></strong>
    </div>
    <div class="col-md-8 col-xs-7">
      <div rel="rdf:type" data-template="v-ui:ClassNameLabelLinkTemplate"></div>
      <veda-control rel="rdf:type" data-type="link" data-template="{individual['rdf:type'][0]['rdfs:label'].join(' ')+': '+individual['rdfs:label'].join(' ')}" class='-view edit search fulltext dropdown'></veda-control>
    </div>
  </div>
  <hr style="margin: 10px 0px"/>
  <div class="row">
    <div class="col-md-4 col-xs-5 text-right">
      <strong about="rdfs:label" property="rdfs:label" class="text-muted"></strong>
    </div>
    <div class="col-md-8 col-xs-7">
      <div property="rdfs:label"></div>
      <veda-control property="rdfs:label" data-type="multilingualString" class='-view edit search'></veda-control>
    </div>
  </div>
  <hr style="margin: 10px 0px"/>
  <div id="properties">
    <div class="row">
      <div class="col-md-4 col-xs-5 text-right name"></div>
      <div class="col-md-8 col-xs-7 value"></div>
    </div>
  </div>
  <br>
  <br>
  <div class="actions clearfix">
    <div about="@" class="pull-left" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete destroy journal task"></div>
    <div class="pull-left">
      <button type="button" class="action btn btn-default view -edit -search" id="rightsOrigin" about="v-s:RightsOrigin" property="rdfs:label"></button>
      <a id="default" class="btn btn-info" href="#/@" about="v-s:Default" property="rdfs:label"></a>
      <a id="generic" class="disabled btn btn-default" href="#/@//v-ui:generic">generic</a>
      <a id="json" class="btn btn-default" href="#/@//v-ui:json">json</a>
      <a id="ttl" class="btn btn-default" href="#/@//v-ui:ttl">ttl</a>
    </div>
  </div>
</div>
<script>
  $("#rightsOrigin.action").on("click", function () {
    veda.Util.showRights(individual);
  });
</script>
  """ ;
.

td:AccountTemplate1
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон Учетной записи"@ru ;
  rdfs:label "Account template"@en ;
  v-ui:forClass v-s:Account ;
  v-ui:template """
<script>
  var _class = new veda.IndividualModel("v-s:Credential");
  _class.rights.then(function (rights) {
    var canCreate = rights.hasValue("v-s:canCreate", true);
    if ( !canCreate ) {
      $("[rel='v-s:usesCredential']", template).remove();
    }
  });

  //# sourceURL=td:AccountTemplate1_pre
</script>
<div class="panel panel-default">
  <div class="panel-heading">
    <div class="row">
      <div class="col-md-6">
        <span about="v-s:Account" property="rdfs:label">Имя класса</span>
      </div>
      <div class="col-md-6 text-right">
        <a href="#/@"><span property="@">ID</span></a>
      </div>
    </div>
  </div>
  <div class="panel-body">
    <h3 property="rdfs:label"></h3>
    <veda-control property="rdfs:label" data-type="string" class="-view edit search"></veda-control>
    <em about="v-s:owner" property="rdfs:label">Владелец</em>
    <div rel="v-s:owner" data-template="v-ui:LabelTemplate" class="view -edit search"></div>
    <veda-control rel="v-s:owner" data-type="link" class="-view edit search fulltext"></veda-control>
    <div class="row">
      <div class="col-md-6">
        <em about="v-s:mailbox" property="rdfs:label">E-mail</em>
        <div property="v-s:mailbox" class="view -edit -search"></div>
        <veda-control property="v-s:mailbox" data-type="string" class="-view edit search"></veda-control>
      </div>
      <div class="col-md-6">
        <em about="v-s:login" property="rdfs:label">Логин</em>
        <div property="v-s:login" class="view -edit -search"></div>
        <veda-control property="v-s:login" data-type="string" class="-view edit search"></veda-control>
      </div>
    </div>
    <div class="row" rel="v-s:usesCredential" data-embedded="true">
      <div class="col-md-6">
        <em about="v-s:password" property="rdfs:label"></em>
        <veda-control property="v-s:password" data-type="password" class="-view edit search"></veda-control>
      </div>
    </div>
  </div>
</div>
  """ ;
.

td:PreferencesTemplate1
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса Предпочтения"@ru ;
  rdfs:label "Template for Preferences class"@en ;
  v-ui:template """
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-4">
        <span about="v-ui:Preferences" property="rdfs:label">Предпочтения</span>
        </div>
        <div class="col-md-8 text-right">
        <a href="#/@"><span property="@">ID</span></a>
        </div>
      </div>
    </div>
    <div class="panel-body">
      <div>
        <em about="v-ui:preferredLanguage" property="rdfs:label">Язык</em>
        <ul rel="v-ui:preferredLanguage">
          <li><div property="rdfs:label"></div></li>
        </ul>
        <veda-control rel="v-ui:preferredLanguage" data-type="link" class="-view edit search fulltext dropdown"></veda-control>
        <em about="v-ui:displayedElements" property="rdfs:label"></em>
        <div property="v-ui:displayedElements" class="view -edit -search"></div>
        <veda-control property="v-ui:displayedElements" data-type="integer" class="-view edit search"></veda-control>
      </div>
    </div>
    <!--div class="actions panel-footer">
      <div about="@" data-template="v-ui:StandardButtonsTemplate" data-embedded="true" data-buttons="edit save cancel delete"></div>
    </div-->
  </div>
  """ ;
.
td:PropertySpecification5
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация работника для класса Назначение"@ru ;
  rdfs:label "Employee property specification for Appointment class"@en ;
  v-ui:forClass v-s:Appointment ;
  v-ui:forProperty v-s:employee ;
  v-ui:minCardinality "0"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:treeRoot d:org_RU1121003135 ;
  v-ui:treeRoot d:org_RU1121003135 ;
  v-ui:treeInProperty v-s:parentUnit ;
  v-ui:treeDisplayedProperty rdfs:label ;
.
td:PropertySpecification6
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация работника для класса Назначение"@ru ;
  rdfs:label "Employee property specification for Appointment class"@en ;
  v-ui:forClass v-s:Appointment ;
  v-ui:forProperty v-s:occupation ;
  v-ui:minCardinality "0"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
.
td:PsParentUnitForAppointment
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация родительского подразделения для класса Назначение"@ru ;
  rdfs:label "ParentUnit property specification for Appointment class"@en ;
  v-ui:forClass v-s:Appointment ;
  v-ui:forProperty v-s:parentUnit ;
  v-ui:queryPrefix "('rdf:type'=='v-s:Department')"^^xsd:string ;
  v-ui:minCardinality "0"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
.
td:PropertySpecification7
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация учетной записи для класса Персона"@ru ;
  rdfs:label "Account property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-s:hasAccount ;
  v-ui:minCardinality "0"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:tooltip "Обязательно к заполнению, единичное значение. Ссылка на объект класса Учетная запись."@ru ;
  v-ui:tooltip "Required, single value. Link to instance of Account class"@en ;
  v-ui:queryPrefix "('rdf:type'=='v-s:Account')"^^xsd:string ;
  v-ui:placeholder "Учетная запись"@ru ;
  v-ui:placeholder "Account"@en ;
.
td:PropertySpecification8
  rdf:type v-ui:ObjectPropertySpecification ;
  rdfs:label "Спецификация предпочтений для класса Персона"@ru ;
  rdfs:label "Preferences property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-ui:hasPreferences ;
#  v-ui:minCardinality "0"^^xsd:nonNegativeInteger ;
#  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:tooltip "Обязательно к заполнению, единичное значение. Ссылка на объект класса Предпочтения."@ru ;
  v-ui:tooltip "Required, single value. Link to instance of Preferences class"@en ;
  v-ui:queryPrefix "('rdf:type'=='v-ui:Preferences')"^^xsd:string ;
.
td:PropertySpecification10
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация тестового свойства для класса Предпочтения"@ru ;
  rdfs:label "Test property specification for Preferences class"@en ;
  v-ui:forClass v-ui:Preferences ;
  v-ui:forProperty v-ui:displayedElements ;
  v-ui:minCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:tooltip "Обязательно к заполнению, единичное целочисленное значение."@ru ;
  v-ui:tooltip "Required, single integer value."@en ;
  v-ui:defaultValue "10"^^xsd:integer ;
.
td:PropertySpecification11
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация тестового свойства для класса Предпочтения"@ru ;
  rdfs:label "Test property specification for Preferences class"@en ;
  v-ui:forClass v-s:Account ;
  v-ui:forProperty v-s:login, v-s:password ;
  v-ui:minCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:tooltip "Обязательно к заполнению, единичное строковое значение."@ru ;
  v-ui:tooltip "Required, single string value."@en ;
.
td:PropertySpecification1
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация даты рождения для класса персона"@ru ;
  rdfs:label "Birthday property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-s:birthday ;
  v-ui:minCardinality "0"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:tooltip "Обязательно к заполнению, единичное значение."@ru ;
  v-ui:tooltip "Required, single value."@en ;
  v-ui:placeholder "день рождения"@ru ;
  v-ui:placeholder "birthday"@en ;
.

td:PropertySpecification2
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация имени для класса персона"@ru ;
  rdfs:label "First name property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-s:firstName ;
  v-ui:minCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "2"^^xsd:nonNegativeInteger ;
  v-ui:minLength "2"^^xsd:integer ;
  v-ui:maxLength "50"^^xsd:integer ;
  v-ui:tooltip "Обязательно к заполнению, единичное значение. Не менее 2 и не более 20 символов"@ru ;
  v-ui:tooltip "Required, single value. More than 2 and less than 20 characters"@en ;
  v-ui:placeholder "имя"@ru ;
  v-ui:placeholder "first name"@en ;
.
td:PropertySpecification3
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация фамилии для класса персона"@ru ;
  rdfs:label "Last name property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-s:lastName ;
  v-ui:minCardinality "0"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "2"^^xsd:nonNegativeInteger ;
  v-ui:minLength "2"^^xsd:integer ;
  v-ui:maxLength "20"^^xsd:integer ;
  v-ui:tooltip "Обязательно к заполнению, единичное значение. Не менее 2 и не более 20 символов"@ru ;
  v-ui:tooltip "Required, single value. More than 2 and less than 20 characters"@en ;
  v-ui:placeholder "фамилия"@ru ;
  v-ui:placeholder "last name"@en ;
.
td:PropertySpecification4
  rdf:type v-ui:DatatypePropertySpecification ;
  rdfs:label "Спецификация отчества для класса персона"@ru ;
  rdfs:label "Middle name property specification for Person class"@en ;
  v-ui:forClass v-s:Person ;
  v-ui:forProperty v-s:middleName ;
  v-ui:minCardinality "0"^^xsd:nonNegativeInteger ;
  v-ui:maxCardinality "1"^^xsd:nonNegativeInteger ;
  v-ui:minLength "2"^^xsd:integer ;
  v-ui:maxLength "20"^^xsd:integer ;
  v-ui:tooltip "Обязательно к заполнению, единичное значение. Не менее 2 и не более 20 символов"@ru ;
  v-ui:tooltip "Required, single value. More than 2 and less than 20 characters"@en ;
  v-ui:placeholder "отчество"@ru ;
  v-ui:placeholder "middle name"@en ;
.

v-ui:Graph
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон графа"@ru ;
  rdfs:label "Template graph"@en ;
  v-ui:template """
<div class="container-fluid sheet">
  <button type="button" id="freeze" class="btn btn-success"><i class="glyphicon glyphicon-pause"></i></button>
  <button type="button" id="export-ttl" class="btn btn-primary"><i class="glyphicon glyphicon-export"></i> Экспорт в ttl</button>

  <div id="graph"></div>

  <div id="individual-context-menu">
    <ul class="dropdown-menu" role="menu">
      <li role="presentation" class="dropdown-header">Индивид</li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="out-links">Все исходящие ссылки</a></li>
      <li><a tabindex="-1" id="in-links">Все входящие ссылки</a></li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="delete">Удалить</a></li>
      <li><a tabindex="-1" id="delete-with-out">Удалить с исходящими</a></li>
      <li><a tabindex="-1" id="delete-with-in">Удалить с входящими</a></li>
    </ul>
  </div>
  <div id="class-context-menu">
    <ul class="dropdown-menu" role="menu">
      <li role="presentation" class="dropdown-header">Класс</li>
      <li><a tabindex="-1" id="class-individuals">Все индивиды</a></li>
      <li><a tabindex="-1" id="class-subclasses">Все подклассы</a></li>
      <li><a tabindex="-1" id="class-properties">Свойства класса</a></li>
      <li><a tabindex="-1" id="class-templates">Шаблоны класса</a></li>
      <li><a tabindex="-1" id="class-specifications">Спецификации класса</a></li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="out-links">Все исходящие ссылки</a></li>
      <li><a tabindex="-1" id="in-links">Все входящие ссылки</a></li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="delete">Удалить</a></li>
      <li><a tabindex="-1" id="delete-with-out">Удалить с исходящими</a></li>
      <li><a tabindex="-1" id="delete-with-in">Удалить с входящими</a></li>
    </ul>
  </div>
  <div id="property-context-menu">
    <ul class="dropdown-menu" role="menu">
      <li role="presentation" class="dropdown-header">Свойство</li>
      <li><a tabindex="-1" id="property-specifications">Спецификации свойства</a></li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="out-links">Все исходящие ссылки</a></li>
      <li><a tabindex="-1" id="in-links">Все входящие ссылки</a></li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="delete">Удалить</a></li>
      <li><a tabindex="-1" id="delete-with-out">Удалить с исходящими</a></li>
      <li><a tabindex="-1" id="delete-with-in">Удалить с входящими</a></li>
    </ul>
  </div>
  <div id="ontology-context-menu">
    <ul class="dropdown-menu" role="menu">
      <li role="presentation" class="dropdown-header">Онтология</li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="out-links">Все исходящие ссылки</a></li>
      <li><a tabindex="-1" id="in-links">Все входящие ссылки</a></li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="delete">Удалить</a></li>
      <li><a tabindex="-1" id="delete-with-out">Удалить с исходящими</a></li>
      <li><a tabindex="-1" id="delete-with-in">Удалить с входящими</a></li>
    </ul>
  </div>
  <div id="template-context-menu">
    <ul class="dropdown-menu" role="menu">
      <li role="presentation" class="dropdown-header">Шаблон</li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="out-links">Все исходящие ссылки</a></li>
      <li><a tabindex="-1" id="in-links">Все входящие ссылки</a></li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="delete">Удалить</a></li>
      <li><a tabindex="-1" id="delete-with-out">Удалить с исходящими</a></li>
      <li><a tabindex="-1" id="delete-with-in">Удалить с входящими</a></li>
    </ul>
  </div>
  <div id="specification-context-menu">
    <ul class="dropdown-menu" role="menu">
      <li role="presentation" class="dropdown-header">Спецификация</li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="out-links">Все исходящие ссылки</a></li>
      <li><a tabindex="-1" id="in-links">Все входящие ссылки</a></li>
      <li role="presentation" class="divider"></li>
      <li><a tabindex="-1" id="delete">Удалить</a></li>
      <li><a tabindex="-1" id="delete-with-out">Удалить с исходящими</a></li>
      <li><a tabindex="-1" id="delete-with-in">Удалить с входящими</a></li>
    </ul>
  </div>
</div>
<script>
  function addNode (individual, opts) {
    if ( nodes.get(individual.id) === null ) {
      var node = {
        id: individual.id,
        label: individual["rdf:type"][0].toString() + String.fromCharCode(10, 13) + individual.toString(),
        individual: individual
      };
      if (individual["rdf:type"][0]) {
        switch ( individual["rdf:type"][0].id ) {
          case "rdfs:Class" :
          case "owl:Class" :
            node.group = "_class";
            break;
          case "rdf:Property" :
          case "owl:ObjectProperty" :
            node.group = "objectProperty";
            break;
          case "owl:DatatypeProperty" :
          case "owl:OntologyProperty" :
          case "owl:AnnotationProperty" :
            node.group = "datatypeProperty";
            break;
          case "v-ui:ClassTemplate" :
            node.group = "template";
            break;
          case "v-ui:PropertySpecification" :
          case "v-ui:DatatypePropertySpecification" :
          case "v-ui:ObjectPropertySpecification" :
            node.group = "specification";
            break;
          case "owl:Ontology" :
            node.group = "ontology";
            break;
          default :
            node.group = "individual";
            break;
        }
      }
      $.extend(node, opts);
      nodes.add ([ node ]);
    }
  }

  function addOutLinks (id) {
    var individual = nodes.get(id).individual;
    Object.getOwnPropertyNames(individual.properties).map(function (property_uri) {
      if(property_uri === "@") { return }
      var values = individual[property_uri];
      if (!values) return;
      values.map(function (value) {
        if (value instanceof veda.IndividualModel && value.id != individual.id) {
          addNode(value);
          var from = individual.id;
          var to = value.id;
          var label = (new veda.IndividualModel(property_uri))["rdfs:label"].join(", ");
          var options = {
            filter: function (item) {
              return  item.from == from &&
                  item.to == to &&
                  item.label.toString() == label;
            }
          };
          if ( !edges.get(options).length ) {
            edges.add ([
              {
                from: from,
                to: to,
                label: label
              }
            ]);
          }
        }
      });
    });
  }

  function addInLinks (id, queryStr) {
    var q = queryStr || "'*'=='{id}'";
    q = q.replace("{id}", id);
    var s = query(veda.ticket, q);
    s.result.forEach(function (uri) {
      var res = new veda.IndividualModel(uri);
      addNode(res);
      var to = id;
      var from = res.id;
      Object.getOwnPropertyNames(res.properties).map(function (property_uri) {
        if (property_uri === "@") { return; }
        if ( res.hasValue(property_uri, id) ) {
          var label = new veda.IndividualModel(property_uri)["rdfs:label"].join(", ");
          var options = {
            filter: function (item) {
              return  item.from === from &&
                item.to === to &&
                item.label.toString() === label;
            }
          };
          if ( !edges.get(options).length ) {
            edges.add([{from: from, to: to, label: label}]);
          }
        }
      });
    });
  }

  function deleteWithOutLinks (id) {
    nodes.remove(id);
    var nodesToRemove = [];
    var edgesToRemove = edges.get({
      filter: function (item) {
        if (item.from == id) {
          nodesToRemove.push(item.to);
        }
        return (item.from == id || item.to == id);
      }
    });
    edges.remove(edgesToRemove);
    nodes.remove(nodesToRemove);
  }

  function deleteWithInLinks (id) {
    nodes.remove(id);
    var nodesToRemove = [];
    var edgesToRemove = edges.get({
      filter: function (item) {
        if (item.to == id) {
          nodesToRemove.push(item.from);
        }
        return (item.from == id || item.to == id);
      }
    });
    edges.remove(edgesToRemove);
    nodes.remove(nodesToRemove);
  }

  // Event handlers
  function onSelect (selected) {
    select = selected;
    body.off("keydown", selectedKeydownHandler);
    body.one("keydown", selected, selectedKeydownHandler);
  }
  function selectedKeydownHandler(e) {
    if (e.which == 46) {
      nodes.remove(e.data.nodes);
      edges.remove(e.data.edges);
    }
    if (e.which == 73) {
      addInLinks(e.data.nodes[0]);
    }
    if (e.which == 79) {
      addOutLinks(e.data.nodes[0]);
    }
  }

  function onDoubleClick (selected) {
    if (!selected.nodes.length) return;
    var individual_uri = selected.nodes[0];
    var modalTmpl = $("#individual-modal-template").html();
    var modal = $(modalTmpl);
    var modalBody = $(".modal-body", modal);
    var individual = new veda.IndividualModel(individual_uri);
    individual.present(modalBody);
    modal.on("remove", function (e) {
      modal.modal("hide");
    });
    modal.modal();
    $("#main").append(modal);
  }

  var root = individual;

  var nodes = new vis.DataSet(), edges = new vis.DataSet();
  var body = $("body");
  var select = {nodes: [], edges: []};
  var graph = $("#graph", template);

  // Buttons
  var exportBtn = $("#export-ttl", template).click(function () {
    var list = nodes.get().map(function (item) { return item.individual; });
    veda.Util.exportTTL(list);
  });
  var freezeBtn = $("#freeze", template).click(function () {
    network.freezeSimulation = !network.freezeSimulation;
    $("i", this).toggleClass("glyphicon-pause glyphicon-play");
  });

  // Context menu for selected node
  graph.contextmenu({
    target: $("#individual-context-menu", template),
    before: function (e, element) {
      if (!select.nodes.length) return false;
      var id = select.nodes[0];
      var node = nodes.get(id);
      switch (node.group) {
        case "_class": this.setMenu($("#class-context-menu", template)); break;
        case "ontology": this.setMenu($("#ontology-context-menu", template)); break;
        case "datatypeProperty":
        case "objectProperty":
          this.setMenu($("#property-context-menu", template)); break;
        case "template": this.setMenu($("#template-context-menu", template)); break;
        case "specification": this.setMenu($("#specification-context-menu", template)); break;
        default: this.setMenu($("#individual-context-menu", template)); break;
      }
      return true;
    },
    onItem: function (context, e) {
      var id = select.nodes[0];
      switch (e.target.id) {
        case "out-links" : addOutLinks( id ); break;
        case "in-links" : addInLinks( id ); break;
        case "delete" :
          nodes.remove(select.nodes);
          edges.remove(select.edges);
          select.nodes = select.edges = [];
          break;
        case "delete-with-out" :
          deleteWithOutLinks (id);
          select.nodes = select.edges = [];
          break;
        case "delete-with-in" :
          deleteWithInLinks (id);
          select.nodes = select.edges = [];
          break;
        case "class-individuals" : addInLinks( id, "'rdf:type'==='{id}'" ); break;
        case "class-subclasses" : addInLinks( id, "('rdf:type'==='owl:Class'||'rdf:type'==='rdfs:Class')&&'rdfs:subClassOf'==='{id}'" ); break;
        case "class-properties" : addInLinks( id, "'rdfs:domain'==='{id}'"); break;
        case "class-templates" : addInLinks( id, "'rdf:type'==='v-ui:ClassTemplate'&&'v-ui:forClass'==='{id}'" ); break;
        case "class-specifications" :
          addInLinks( id, "('rdf:type'==='v-ui:PropertySpecification' || " +
                  "'rdf:type'==='v-ui:DatatypePropertySpecification' || " +
                  "'rdf:type'==='v-ui:ObjectPropertySpecification'" +
                  ")&&'v-ui:forClass'==='{id}'" );
        break;
        case "property-specifications" :
          addInLinks( id, "('rdf:type'==='v-ui:PropertySpecification' || " +
                  "'rdf:type'==='v-ui:DatatypePropertySpecification' || " +
                  "'rdf:type'==='v-ui:ObjectPropertySpecification'" +
                  ")&&'v-ui:forProperty'=='{id}'" );
        break;
      }
    }
  });

  // Create a network
  var data = {
    nodes: nodes,
    edges: edges,
  };

  addNode(root);
  addOutLinks(root.id);

  var height = ( $("#copyright").offset().top - graph.offset().top - 50 ) + "px";
  var options = {
    width: "100%",
    height: height,
    nodes: {
      shape: "box"
    },
    edges: {
      style: "arrow",
      arrowScaleFactor: 0.7
    },
    groups: {
      _class: {
        color: {
          border: 'green',
          background: 'lightgreen',
          highlight: {
            border: 'green',
            background: 'lightgreen'
          }
        }
      },
      datatypeProperty: {
        color: {
          border: 'goldenrod',
          background: 'gold',
          highlight: {
            border: 'goldenrod',
            background: 'gold'
          }
        }
      },
      objectProperty: {
        color: {
          border: 'darkorange',
          background: 'orange',
          highlight: {
            border: 'darkorange',
            background: 'orange'
          }
        }
      },
      template: {
        color: {
          border: 'darkviolet',
          background: 'violet',
          highlight: {
            border: 'darkviolet',
            background: 'violet'
          }
        }
      },
      specification: {
        color: {
          border: 'hotpink',
          background: 'lightpink',
          highlight: {
            border: 'hotpink',
            background: 'lightpink'
          }
        }
      },
      ontology: {
        color: {
          border: 'darkgreen',
          background: 'green',
          highlight: {
            border: 'darkgreen',
            background: 'green'
          }
        },
        fontColor: "white"
      },

    },
    physics: {
      barnesHut: {
        enabled: true,
        gravitationalConstant: -4000,
        centralGravity: 0.1,
        springLength: 200,
        springConstant: 0.04,
        damping: 0.09
      },
      /*repulsion: {
        centralGravity: 0.1,
        springLength: 50,
        springConstant: 0.05,
        nodeDistance: 100,
        damping: 0.09
      },*/
      /*hierarchicalRepulsion: {
        centralGravity: 0.5,
        springLength: 150,
        springConstant: 0.01,
        nodeDistance: 300,
        damping: 0.09
      }*/
    },

  };

  var network = new vis.Network(graph.get(0), data, options);

  // Add event listeners
  network.on("doubleClick", onDoubleClick);

  network.on("select", onSelect);

  //# sourceURL=v-ui:Graph
</script>
  """ ;
.

